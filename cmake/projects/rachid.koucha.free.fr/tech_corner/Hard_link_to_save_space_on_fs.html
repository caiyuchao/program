<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
  <title>hard links to save space on file systems</title>
  <meta name="author" content="rachid koucha">
  <meta name="Category" content="Linux, file system">
  <meta name="language" content="en">
  <meta http-equiv="Content-Language" content="en">
  <meta name="description"
 content="article comparing hard links and symbolic links in linux file systems">
  <meta name="keywords"
 content="linux, file system, hard link, symbolic link">
  <script type="text/javascript"
 src="https://apis.google.com/js/plusone.js"></script>
</head>
<body>
<small><small><span style="text-decoration: underline;">Author</span>:
R. Koucha<br>
<span style="text-decoration: underline;">Last update</span>:
06-Avr-2008</small>
<br>
</small><br>
<small><a href="../index.html">Back to main page</a><br>
<a href="../technical_documents.html">Back to previous page</a></small><br>
<br>
<h1 style="text-align: center;">Hard links to make
embedded&nbsp;file systems</h1>
<h1 style="text-align: center;">more efficient</h1>
<br>
<table
 style="text-align: left; margin-left: auto; margin-right: auto; background-color: rgb(192, 192, 192);">
  <tbody>
    <tr>
      <td>
      <script type="text/javascript"><!--
google_ad_client = "pub-9113501896220746";
/* 728x90, date de creation 29/03/08 */
google_ad_slot = "7632855209";
google_ad_width = 728;
google_ad_height = 90;
//--></script>
      <script type="text/javascript"
 src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="text-align: left; width: 100%;" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; height: 50%; width: 50%;"><br>
      </td>
      <td style="vertical-align: top;"><iframe
 src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Frachid.koucha.free.fr%2Ftech_corner%2FHard_link_to_save_space_on_fs.html&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light&amp;height=80"
 style="border: medium none ; overflow: hidden; width: 450px; height: 80px;"
 allowtransparency="true" frameborder="0" scrolling="no"></iframe> <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><g:plusone size="medium"></g:plusone>
      <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><a
 href="mailto:?body=http%3A%2F%2Frachid.koucha.free.fr%2Ftech_corner%2FHard_link_to_save_space_on_fs.html&amp;subject=Hard%20links%20in%20Linux%20file%20systems"><img
 alt="s" src="../send_to_a_friend.gif"
 style="border: 0px solid ; width: 30px; height: 21px;"></a></td>
    </tr>
  </tbody>
</table>
<br>
<a href="#Introduction">Introduction</a><br>
<a href="#Recap">Recap</a><br>
<a href="#A_hard_link_consumes_less_space_than_a">A hard
link consumes less space than a symbolic link</a><br>
<a href="#The_access_to_a_hard_link_is_more">The access to
a hard link is more efficient than the access to a symbolic link</a><br>
<a href="#About_the_author">About the
author</a><br>
<br>
<br>
<h2><a name="Introduction"></a>Introduction</h2>
It is a good rule of thumb to keep embedded file systems as tiny and
efficient as possible. Moreover when the target is a memory based file
system&nbsp;or it is driven by a slow processor or the memory is
space
is very limited.<br>
<br>
Replacing symbolic by hard links is one option to keep the file system
as small as possible. Possible applications are the targets using
<span style="font-style: italic;">busybox</span> where all the shell
excutables are linked to one executable
called <span style="font-style: italic;">busybox</span>. The "lib"
directory is another typical candidate as
most library names are links.<br>
<br>
<h2><a name="Recap"></a>Recap</h2>
<br>
A link allows a file to appearc multiple time in the file systems.<br>
<br>
A hard links
cannot span file systems, and is actually an additional reference to a
file stored in that file system. Deleting the "original" file will not
remove the file until the last hard link has been removed as well (the
link count equals zero).<br>
<br>
A symbolic link is a special type of file that
only stores the path to the "original" file, and this type of file can
span file systems. Deleting a symbolic link will not delete the
"original" file, and deleting the original file will not removed the
link, but leave it "unresolved." An attempt to read an unresolved link
will result in a "File Not Found" message.<br>
<br>
Both hard links and symbolic links are created thanks to the "ln" shell
command. In the latter case, we use the option "-s".<br>
<br>
When using the "ls" shell command, it is easy to distinguish symbolic
links from other files as an arrow is displayed:<br>
<br>
<span style="font-family: monospace;">&gt; ls -l /lib</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">[...]</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">lrwxrwxrwx&nbsp;
1 root root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 21
2007-02-08 13:17 cpp <span style="color: rgb(255, 0, 0);">-&gt;</span>
/etc/alternatives/cpp</span><br style="font-family: monospace;">
<span style="font-family: monospace;">drwxr-xr-x&nbsp;
2 root root&nbsp;&nbsp;&nbsp; 4096 2006-10-25 16:03
dhcp3-client</span><br style="font-family: monospace;">
<span style="font-family: monospace;">drwxr-xr-x&nbsp;
5 root root&nbsp;&nbsp;&nbsp; 4096 2007-07-21 22:12 firmware</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">drwxr-xr-x&nbsp;
3 root root&nbsp;&nbsp;&nbsp; 4096 2006-10-25 16:11 grub</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">lrwxrwxrwx&nbsp;
1 root root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 19
2007-02-08 13:17 i386-linux-gnu <span style="color: rgb(255, 0, 0);">-&gt;</span>
/lib/i486-linux-gnu</span><br style="font-family: monospace;">
<span style="font-family: monospace;">drwxr-xr-x&nbsp;
2 root root&nbsp;&nbsp;&nbsp; 4096 2006-10-10 16:33
i486-linux-gnu<br>
[...]<br>
<br>
</span>For hard links it is more difficult to distinguish them as
we
need to display its inode number and find in the file system another
file name with the same inode number. In the following example, the
hard links are located in the same directory. So, when we use the "-i"
option of "ls", we can see that they point on the same inode:<br>
<br>
<span style="font-family: monospace;">&gt;&nbsp;ls
-li</span><br style="font-family: monospace;">
<span style="font-family: monospace;">total 8</span><br
 style="font-family: monospace;">
<span style="color: rgb(255, 0, 0); font-family: monospace;">2031740</span><span
 style="font-family: monospace;">
-rw-r--r-- 2 koucha koucha 1 2007-08-14 12:30 bar</span><br
 style="font-family: monospace;">
<span style="color: rgb(255, 0, 0); font-family: monospace;">2031740</span><span
 style="font-family: monospace;">
-rw-r--r-- 2 koucha koucha 1 2007-08-14 12:30 foo</span><br
 style="font-family: monospace;">
<br>
The third columns gives the number of hard links in the inode.<br>
<span style="font-family: monospace;"></span><br>
<h2><a name="A_hard_link_consumes_less_space_than_a"></a>A
hard link consumes less space than a symbolic link</h2>
Only one inode for all the hard links to a same file: reference counter
in the inode.<br>
<br>
One inode per symbolic links: each inode points on data block where is
stored the name of the target link. So, we consume one inode and
potentially data blocks if the name of the target link is not stored in
the inode itself (on some file systems like ext2, the name of the
target link is stored in the inode itself unless the name is very long.
If too long, the name is stored in the data blocks)<br>
<br>
<h2><a name="The_access_to_a_hard_link_is_more"></a>The
access to a hard link is more efficient than the access to a symbolic
link</h2>
<ul>
  <li>
    <h3>Search algorithm for a symbolic link</h3>
  </li>
</ul>
<br>
Let's say we have the following symbolic link: /home/user/foo
--&gt; /other/bar<br>
<br>
<br>
Each time we access the symbolic link "/home/user/foo", we implicitely
search for the inode of the file "bar":<br>
<ol>
  <li>Look for&nbsp;inode of "/" : root inode</li>
  <li>As the root inode describes a directory, look for "home" in
the data blocks pointed by the root inode</li>
  <li>The entry "home" provides the inode number of the directory
"home"</li>
  <li>Look for the file "foo" in the data blocks pointed by the
inode of "home"</li>
  <li>The entry "foo" provides the inode number of the file "foo"</li>
  <li>foo's inode indicates that foo is a symbolic link to
"/other/bar"</li>
  <li>Look for&nbsp;inode of "/" : root inode</li>
  <li>As the root inode describes a directory, look for
"other"&nbsp; in the data blocks pointed by the root inode</li>
  <li>The entry "other" provides the inode number of the
directory "other"</li>
  <li>Look for the file "bar" in the data blocks pointed by the
inode of "other"</li>
  <li>The entry "other" provides the inode number of the file
"other"</li>
</ol>
<br>
<ul>
  <li>
    <h3>Search algorithm for a hard link</h3>
  </li>
</ul>
Let's say we have the following hard link: /home/user/foo --&gt;
/other/bar<br>
<br>
<br>
Each time we access the hard link "/home/user/foo", we implicitely
search for the inode of the file "bar":<br>
<ol>
  <li>Look for&nbsp;inode of "/" : root inode</li>
  <li>As the root inode describes a directory, look for "home" in
the data blocks pointed by the root inode</li>
  <li>The entry "home" provides the inode number of the directory
"home"</li>
  <li>Look for the file "foo" in the data blocks pointed by the
inode of "home"</li>
  <li>The entry "foo" provides the inode number of the file "foo"
which is the inode of "bar" as well</li>
</ol>
<br>
<h2><a name="About_the_author"></a>About the
author</h2>
The author is an engineer in computer sciences located in France. He
can be contacted <a
 href="http://rachid.koucha.free.fr/contact/contact.html">here</a> or
you can have
a look at his <a href="http://rachid.koucha.free.fr/">WEB
home page</a>.<br>
<br>
<div style="text-align: right;"><small><a href="../index.html">Back to
main page</a></small><br>
<small><a href="../technical_documents.html">Back to previous page</a></small><br>
</div>
</body>
</html>
