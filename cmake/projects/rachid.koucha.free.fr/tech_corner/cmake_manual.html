<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>How to use cmake</title>
  <meta name="author" content="rachid koucha">
  <meta name="Category"
 content="cmake, linux, gcc, freeware, build, make">
  <meta name="language" content="en">
  <meta http-equiv="Content-Language" content="en">
  <meta name="description"
 content="Empirical approach to cmake: step by step presentation of projects based on cmake build system">
  <meta name="keywords"
 content="cmake, linux, build, gcc, freeware, make">
  <script type="text/javascript"
 src="https://apis.google.com/js/plusone.js"></script>
</head>
<body>
<small><small><span style="text-decoration: underline;">Author</span>:
<a href="http://rachid.koucha.free.fr">R. Koucha</a><br>
<span style="text-decoration: underline;">Last update</span>:
06-May-2012<br>
<br>
</small></small><small><br>
<a href="http://rachid.koucha.free.fr/index.html">Back to main page</a><br>
<a href="http://rachid.koucha.free.fr/technical_documents.html">Back to
previous page</a></small><br>
<br>
<h1 style="text-align: center;">Empirical approach to CMAKE</h1>
<table
 style="text-align: left; margin-left: auto; margin-right: auto; background-color: rgb(153, 255, 255);">
  <tbody>
    <tr>
      <td>
      <script type="text/javascript"><!--
google_ad_client = "pub-9113501896220746";
/* 728x90, date de création 29/03/08 */
google_ad_slot = "7632855209";
google_ad_width = 728;
google_ad_height = 90;
//--></script>
      <script type="text/javascript"
 src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="text-align: left; width: 100%;" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; height: 50%; width: 50%;"><br>
      </td>
      <td style="vertical-align: top;"><iframe
 src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Frachid.koucha.free.fr%2Ftech_corner%2Fcmake_manual.html&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light&amp;height=80"
 style="border: medium none ; overflow: hidden; width: 450px; height: 80px;"
 allowtransparency="true" frameborder="0" scrolling="no"></iframe> <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><g:plusone size="medium"></g:plusone>
      <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><a
 href="mailto:?body=http%3A%2F%2Frachid.koucha.free.fr%2Ftech_corner%2Fcmake_manual.html&amp;subject=Empirical%20approach%20to%20cmake"><img
 alt="s" src="../send_to_a_friend.gif"
 style="border: 0px solid ; width: 30px; height: 21px;"></a></td>
    </tr>
  </tbody>
</table>
<br>
<br>
<a href="#Introduction">Introduction</a><br>
<a href="#Project_1:_Generation_of_an_executable"><span
 style="text-decoration: underline;">Project 1</span>:
Generation of an executable</a><br>
<a href="#Project_2:_Generation_of_an_executable"><span
 style="text-decoration: underline;">Project 2</span>:
Generation of an executable linked to a library</a><br>
<a href="cmake_manual.html#PROJECT_2"><span
 style="text-decoration: underline;"></span></a><a
 href="#Project_3:_Generation_of_an_executable"><span
 style="text-decoration: underline;">Project 3</span>:
Generation of an executable and a shared library with the same name</a><br>
<a href="#Project_4:_Generation_and_installation"><span
 style="text-decoration: underline;">Project 4</span>:
Generation and installation of a program along with its manuals</a><br>
<a href="#Project_5:_Installation_of_an_executable"><span
 style="text-decoration: underline;">Project 5</span>:
Installation of an executable and an API in a shared library along with
the include files and manuals</a><br>
<a href="#Project_6:_Packaging_of_a_project">Project 6:
Packaging of a project</a><br>
<a href="#Project_7:_Generation_of_a_configuration">Project 7:
Generation of a configuration file (config.h)</a><br>
<a href="#Project_8:_Generation_of_a_Linux_user_">Project 8: Generation
of a Linux user space program along with its kernel module</a><br>
<a href="#Project_9:_Generation_of_a_graphical">Project 9: Generation
of a graphical executable based on Qt library</a><br>
<a href="#Open_source_projects_using_cmake">Open source projects using
cmake</a><br>
<a href="#Resources">Resources</a><br>
<a href="#About_the_author">About the author</a><br>
<br>
<hr style="width: 100%; height: 2px;"><br>
<h2><a name="Introduction"></a>Introduction</h2>
<span style="font-style: italic;">cmake</span> is a
brand new building tool for software projects. It aims at
replacing the old fashioned <span style="font-style: italic;">autotools</span>.<br>
<br>
<span style="font-style: italic;">cmake</span> is
open source and is well described <a href="http://www.cmake.org">here</a>.
Among
the
numerous
provided
features,
we
can
list
the
following:<br>
<ul>
  <li>Supports complex, large build environments;</li>
  <li>Generates native build files (e.g. makefiles on Unix).
Therefore standard tools can be used on any platform/compiler
configuration;</li>
  <li>Can be easily extended to add new features;</li>
  <li>...</li>
</ul>
<br>
The purpose of this paper is to make the reader master some basic uses
of <span style="font-style: italic;">cmake</span>
through some tiny software projects.<br>
<br>
<hr style="width: 100%; height: 2px;"><br>
<h2><a name="Project_1:_Generation_of_an_executable"></a><span
 style="text-decoration: underline;">Project 1</span>:
Generation of an executable</h2>
The project called <span style="font-weight: bold;">PROJECT1</span>
is composed with the following sub-tree (the files are located <a
 href="http://rachid.koucha.free.fr/tech_corner/cmake_projects/project1">here</a>):<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto; font-family: monospace;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td>&nbsp;&nbsp; <span style="font-weight: bold;">project1</span><br>
&nbsp; &nbsp;&nbsp; /\<br>
&nbsp;&nbsp;&nbsp;&nbsp;/
&nbsp;\<br>
&nbsp; &nbsp;/ &nbsp; &nbsp;\<br>
&nbsp;<a href="cmake_projects/project1/main.c">main.c</a> simple<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"><span
 style="font-family: monospace;"></span></span>The
project generates one target: an executable called <span
 style="font-weight: bold;">simple</span>.
All the objects are stored into the top level directory<span
 style="font-style: italic;"></span>.<br>
<br>
The following sub-tree shows the files that have been added to build
the project.<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td><span style="font-family: monospace;"><span
 style="font-family: monospace;">&nbsp;</span><span
 style="font-family: monospace; font-weight: bold;">&nbsp; &nbsp;&nbsp;
project1<br>
      </span><span style="font-family: monospace;">&nbsp;
&nbsp;&nbsp;&nbsp; /&nbsp; |
&nbsp; \<br>
&nbsp; &nbsp; &nbsp;/&nbsp;
&nbsp;|&nbsp; &nbsp; \<br>
&nbsp; &nbsp; /
&nbsp; &nbsp;|&nbsp; &nbsp; &nbsp;\<br>
&nbsp;&nbsp; / &nbsp; &nbsp; |&nbsp;&nbsp;
&nbsp; &nbsp;\<br>
      <a href="cmake_projects/project1/main.c">main.c</a> &nbsp;simple
&nbsp;<a href="#CMakeLists.txt_in_project1">CMakeLists.txt</a></span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"></span></span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"><span
 style="font-family: monospace;"></span></span>Once
the <span style="font-style: italic;">cmake</span> files are setup,
launch <span style="font-style: italic;">cmake</span>
to generate the build
environment:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ cd project1</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">$ cmake .</span><br>
      <span style="font-family: monospace;">-- The C compiler
identification is GNU</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">-- Check for working C
compiler: /usr/bin/gcc</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">-- Check for working C
compiler: /usr/bin/gcc -- works</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">-- Detecting C compiler ABI
info</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">-- Detecting C compiler ABI
info - done</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">-- Configuring done</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">-- Generating done</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">-- Build files
have been written to: .../project1</span></td>
    </tr>
  </tbody>
</table>
<br style="font-family: monospace;">
Then, the makefiles are ready to trigger a build with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make</span><br>
      <span style="font-family: monospace;">[100%] Building C object
CMakeFiles/simple.dir/main.c.o</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">Linking C executable simple
      </span><br style="font-family: monospace;">
      <span style="font-family: monospace;">[100%] Built target simple <br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
After it is possible to clean-up anything generated by the <span
 style="font-style: italic;">cmake</span>
environment with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make clean</span></td>
    </tr>
  </tbody>
</table>
<br>
<h3><a name="CMakeLists.txt_in_project1"></a>CMakeLists.txt
in project1</h3>
The <span style="font-style: italic;">project1</span>
directory is the top directory of the project. This is the place where
we launch
the <span style="font-style: italic;">cmake</span>
command.<br>
<br>
This is the top <span style="font-style: italic;">CMakeLists.txt</span>
of the project.<br>
We define the minimum version of <span style="font-style: italic;">cmake</span>
that we support for this project through the directive <span
 style="font-weight: bold;">CMAKE_MINIMUM_REQUIRED</span>.<br>
We identify the project as well as the programming language with the <span
 style="font-weight: bold;">PROJECT</span> directive.<br>
We define the flags that will be passed as arguments to the compiler
through the <span style="font-weight: bold;">ADD_DEFINITIONS</span>
directive. It is optional to do it but the default flags passed to the
compiler are not sufficiently severe to check and report the warnings
and bugs.<br>
We specify the target executable <span style="font-style: italic;">simple</span>
with
the <span style="font-weight: bold;">ADD_EXECUTABLE</span>
directive.<br>
<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">CMAKE_MINIMUM_REQUIRED(VERSION 2.6)<br>
      <br>
      </span><span style="font-family: monospace;">PROJECT(project1 C)<br>
      <br>
ADD_DEFINITIONS(-g
-O2 -fsigned-char -freg-struct-return -Wall -W -Wshadow
-Wstrict-prototypes -Wpointer-arith -Wcast-qual -Winline -Werror)<br>
      <br>
ADD_EXECUTABLE(simple main.c)<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><br>
<hr style="width: 100%; height: 2px;"><br>
<h2><a name="Project_2:_Generation_of_an_executable"></a><span
 style="text-decoration: underline;">Project 2</span>:
Generation of an executable linked to a library</h2>
The project called <span style="font-weight: bold;">PROJECT2</span>
is composed with the following sub-tree (the files are located <a
 href="http://rachid.koucha.free.fr/tech_corner/cmake_projects/project2">here</a>):<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto; font-family: monospace;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td>&nbsp;<span style="font-weight: bold;">&nbsp; project2<br>
      </span>&nbsp; &nbsp;&nbsp; /\<br>
&nbsp;&nbsp;&nbsp;&nbsp;/
&nbsp;\<br>
&nbsp; &nbsp;/ &nbsp; &nbsp;\<br>
&nbsp;<a href="cmake_projects/project2/main.c">main.c</a> &nbsp;crypto<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"><span
 style="font-family: monospace;"></span></span>The
project generates one target: an executable called <span
 style="font-weight: bold;">crypto</span>.
All the objects are stored into the top level directory<span
 style="font-style: italic;"></span>. The executable
needs the standard library <span style="font-style: italic;">libcrypt.so</span>.<br>
<br>
The following sub-tree shows the files that have been added to build
the project.<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto; font-family: monospace;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td>&nbsp;<span style="font-weight: bold;">&nbsp; &nbsp;&nbsp;
project2<br>
      </span>&nbsp; &nbsp; &nbsp; /&nbsp; | &nbsp; \<br>
&nbsp; &nbsp; &nbsp;/&nbsp;
&nbsp;|&nbsp; &nbsp; \<br>
&nbsp; &nbsp; /
&nbsp; &nbsp;|&nbsp; &nbsp; &nbsp;\<br>
&nbsp;&nbsp; / &nbsp; &nbsp; |&nbsp;&nbsp;
&nbsp; &nbsp;\<br>
      <a href="cmake_projects/project2/main.c">main.c</a> &nbsp;crypto
&nbsp;<a href="#CMakeLists.txt_in_project2">CMakeLists.txt</a><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"><span
 style="font-family: monospace;"></span></span>Once
the cmake files are setup, launch <span style="font-style: italic;">cmake</span>
to generate the build
environment:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ cd project2</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">$ cmake .</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">-- The C compiler
identification is GNU<br>
-- Check for working C compiler: /usr/bin/gcc<br>
-- Check for working C compiler: /usr/bin/gcc -- works<br>
-- Detecting C compiler ABI info<br>
-- Detecting C compiler ABI info - done<br>
-- Configuring done<br>
-- Generating done<br>
-- Build files have been written to: .../project2<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><span
 style="font-family: monospace;"></span><br
 style="font-family: monospace;">
Then, the makefiles are ready to trigger a build with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">[100%] Building C object
CMakeFiles/crypto.dir/main.c.o<br>
Linking C executable crypto<br>
[100%] Built target crypto<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
After it is possible to clean-up anything generated by the <span
 style="font-style: italic;">cmake</span>
environment with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make clean</span></td>
    </tr>
  </tbody>
</table>
<br>
<h3><a name="CMakeLists.txt_in_project2"></a>CMakeLists.txt
in project2</h3>
The <span style="font-style: italic;">project2</span>
directory is the top directory of the project. This is the place where
we launch
the <span style="font-style: italic;">cmake</span>
command.<br>
<br>
This is the top <span style="font-style: italic;">CMakeLists.txt</span>
of the project.<br>
We define the minimum version of <span style="font-style: italic;">cmake</span>
that we support for this project through the directive <span
 style="font-weight: bold;">CMAKE_MINIMUM_REQUIRED</span>.<br>
We identify the project as well as the programming language with the <span
 style="font-weight: bold;">PROJECT</span> directive.<br>
We define the flags that will be passed as arguments to the compiler
through the <span style="font-weight: bold;">ADD_DEFINITIONS</span>
directive. It is optional to do it but the default flags passed to the
compiler are not sufficiently severe to check and report the warnings
and bugs.<br>
We specify the target executable <span style="font-style: italic;">crypto</span>
with
the <span style="font-weight: bold;">ADD_EXECUTABLE</span>
directive.<br>
As <span style="font-style: italic;">crypto</span> needs the <span
 style="font-style: italic;">libcrypt.so</span>
library, we specify it with the directive <span
 style="font-weight: bold;">TARGET_LINK_LIBRARIES</span>.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">CMAKE_MINIMUM_REQUIRED(VERSION 2.6)<br>
      <br>
      </span><span style="font-family: monospace;">PROJECT(project2 C)<br>
      <br>
ADD_DEFINITIONS(-g
-O2 -fsigned-char -freg-struct-return -Wall -W -Wshadow
-Wstrict-prototypes -Wpointer-arith -Wcast-qual -Winline -Werror)<br>
      <br>
ADD_EXECUTABLE(crypto main.c)<br>
      <br>
TARGET_LINK_LIBRARIES(crypto crypt)<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span>
<hr style="width: 100%; height: 2px;"><span
 style="font-family: monospace;"></span><br>
<h2><a name="Project_3:_Generation_of_an_executable"></a><span
 style="text-decoration: underline;">Project 3</span>:
Generation of an executable and a shared library with the same name</h2>
<br>
The project called <span style="font-weight: bold;">ROOF</span>
is composed with the following sub-tree:<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto; font-family: monospace;"
 border="3">
  <tbody>
    <tr>
      <td
 style="text-align: left; vertical-align: middle; background-color: rgb(51, 255, 51); white-space: nowrap;">&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;


































      <span style="font-weight: bold;">&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;<big>roof</big><br>
&nbsp;</span><span style="font-family: monospace;"> &nbsp; &nbsp;
&nbsp; &nbsp;&nbsp;
&nbsp;/ &nbsp;
| &nbsp;\ &nbsp; &nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp; /
&nbsp;&nbsp;&nbsp;| &nbsp; \ &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;/ &nbsp;
&nbsp; | &nbsp; &nbsp;\ &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp; &nbsp;&nbsp; / &nbsp;
&nbsp;&nbsp;&nbsp;| &nbsp; &nbsp; \ &nbsp;
&nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp; &nbsp; / &nbsp; &nbsp; &nbsp;
| &nbsp; &nbsp; &nbsp;\ &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp;&nbsp; / &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;| &nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp;&nbsp; &nbsp;/ &nbsp; &nbsp; &nbsp;
&nbsp;
| &nbsp; &nbsp; &nbsp;&nbsp; \ &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;
&nbsp; / &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
| &nbsp; &nbsp; &nbsp; &nbsp; \ &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
&nbsp;
&nbsp; <span style="font-weight: bold;">lib</span><small> &nbsp;
&nbsp;
&nbsp; &nbsp;</small><span style="font-weight: bold;">client</span><small>
&nbsp;&nbsp;<span style="font-weight: bold;"><big>include</big>
&nbsp;<big>bin</big></span></small><br>
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp;| &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;| &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;| &nbsp; &nbsp; &nbsp;|</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp;&nbsp;&nbsp;|&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; |
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;
&nbsp; &nbsp;|</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;
roof.c &nbsp; &nbsp;&nbsp;&nbsp;main.c &nbsp;
&nbsp;roof.h &nbsp; main.o</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;
roof_p.h &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;roof.o</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;roof</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;
&nbsp;libroof.so</span><br style="font-family: monospace;">
      </td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><br>
The project generates two targets: a shared library called <span
 style="font-weight: bold;">libroof.so</span> and an
executable called <span style="font-weight: bold;">roof</span>.
All the objects are stored into the sub-directory <span
 style="font-style: italic;">bin</span>.<br>
<br>
The following sub-tree shows the files that have been added to build
the project.<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto;"
 border="3">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(51, 255, 51); white-space: nowrap;"><span
 style="font-family: monospace;">&nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;
&nbsp; &nbsp; <span style="font-weight: bold;">&nbsp;
&nbsp; &nbsp; &nbsp;<big>roof</big><br>
      </span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;/ &nbsp; &nbsp; &nbsp; &nbsp;
| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \
&nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; &nbsp; \<br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp; /
&nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; \ &nbsp; &nbsp;
&nbsp; \ &nbsp; &nbsp; &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;/ &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; \ &nbsp;
&nbsp; &nbsp; \ &nbsp; &nbsp; &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; &nbsp; &nbsp;
/ &nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;| &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; \ &nbsp; &nbsp; &nbsp;
&nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;/ &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; \ &nbsp;
&nbsp; &nbsp; \ &nbsp; &nbsp; &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; &nbsp; /
&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;| &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; \ &nbsp; &nbsp; &nbsp; \ &nbsp; &nbsp;
&nbsp; &nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;&nbsp;&nbsp;/
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
| &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; \ &nbsp; &nbsp; &nbsp;
&nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; / &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; \ &nbsp; &nbsp; &nbsp;
&nbsp; \</span><br style="font-family: monospace;">
&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;">lib</span><small>
&nbsp; &nbsp; &nbsp; &nbsp;</small><span style="font-weight: bold;">
&nbsp; &nbsp;
&nbsp;client</span><small> &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold;"><big>include</big>
&nbsp;&nbsp; <big>bin &nbsp; </big></span><a
 href="cmake_manual.html#CMakeLists.txt_in_roof"><big>CMakeLists.txt</big></a></small><br>
      <span style="font-family: monospace;">&nbsp;&nbsp; &nbsp;| &nbsp;
&nbsp;
&nbsp;&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;|</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;&nbsp;|&nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
| &nbsp; &nbsp; &nbsp; &nbsp;|</span><br style="font-family: monospace;">
&nbsp;&nbsp;roof.c &nbsp; &nbsp;&nbsp; &nbsp;
&nbsp; &nbsp; main.c &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; roof.h &nbsp;
&nbsp; main.o<br>
&nbsp; roof_p.h &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; </span><a style="font-family: monospace;"
 href="cmake_manual.html#CMakeLists.txt_in_client"><small><big>CMakeLists.txt</big></small></a><span
 style="font-family: monospace;"> &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; roof.o<br>
&nbsp; </span><a style="font-family: monospace;"
 href="cmake_manual.html#CMakeLists.txt_in_lib"><small><big>CMakeLists.txt</big></small></a><span
 style="font-family: monospace;"><span style="font-family: monospace;">
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;&nbsp; roof</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;
libroof.so</span><br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><br>
<br>
Once the cmake files are setup, launch cmake to generate the build
environment:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ cd roof</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">$ cmake .</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">-- Configuring
done</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">-- Generating
done</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">-- Build files
have been written to: .../roof</span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><span
 style="font-family: monospace;"></span><br
 style="font-family: monospace;">
<br style="font-family: monospace;">
Then, the makefiles are ready to trigger a build with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">[ 50%]
Building C object bin/CMakeFiles/roof.dir/roof.o</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">Linking C
shared library libroof.so</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">[ 50%] Built
target roof</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">[100%]
Building C object bin/CMakeFiles/main.dir/main.o</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">Linking C
executable roof</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">[100%] Built
target main</span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><span
 style="font-family: monospace;"></span><br
 style="font-family: monospace;">
<br>
After it is possible to clean-up anything generated by the <span
 style="font-style: italic;">cmake</span>
environment with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make clean</span></td>
    </tr>
  </tbody>
</table>
<br>
<br>
<h3><a name="CMakeLists.txt_in_roof"></a>CMakeLists.txt
in roof</h3>
The directory <span style="font-style: italic;">roof</span>
is the top directory of the project. This is the place where we launch
the <span style="font-style: italic;">cmake</span>
command.<br>
<br>
This is the top <span style="font-style: italic;">CMakeLists.txt</span>
of the project.<br>
We define the minimum version of <span style="font-style: italic;">cmake</span>
that we support for this project through the directive <span
 style="font-weight: bold;">CMAKE_MINIMUM_REQUIRED</span>.<br>
We identify the project as well as the programming language with the <span
 style="font-weight: bold;">PROJECT</span> directive.<br>
We specify the directories where are located the include files (<span
 style="font-style: italic;">include</span> and <span
 style="font-style: italic;">lib</span>) with the <span
 style="font-weight: bold;">INCLUDE_DIRECTORIES</span>
directive.<br>
We define the flags that will be passed as arguments to the compiler
through the <span style="font-weight: bold;">ADD_DEFINITIONS</span>
directive. It is optional to do it but the default flags passed to the
compiler are not sufficiently severe to check and report the warnings
and bugs.<br>
We specify the list of sub-directories where are located the sources to
compile (<span style="font-style: italic;">lib</span>
and <span style="font-style: italic;">client</span>)
along with the target binary directory where are going the object files
(<span style="font-style: italic;">bin</span>) with
the <span style="font-weight: bold;">ADD_SUBDIRECTORY</span>
directive.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">CMAKE_MINIMUM_REQUIRED(VERSION 2.6)<br>
      <br>
      </span><span style="font-family: monospace;">PROJECT(roof C)<br>
      <br>
INCLUDE_DIRECTORIES(include lib) </span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">ADD_DEFINITIONS(-g
-O2 -fsigned-char -freg-struct-return -Wall -W -Wshadow
-Wstrict-prototypes -Wpointer-arith -Wcast-qual -Winline -Werror)</span><br
 style="font-family: monospace;">
      <br style="font-family: monospace;">
      <br style="font-family: monospace;">
      <span style="font-family: monospace;">ADD_SUBDIRECTORY(lib
bin) </span><br style="font-family: monospace;">
      <span style="font-family: monospace;">ADD_SUBDIRECTORY(client
bin)</span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"><br>
</span><span style="font-family: monospace;"></span>
<h3><a name="CMakeLists.txt_in_lib"></a>CMakeLists.txt
in lib</h3>
The directory <span style="font-style: italic;">lib</span>
contains all the files to make the library <span
 style="font-style: italic;">libroof.so</span>.<br>
<br>
We assign a variable called <span style="font-style: italic;">roof_lib_src</span>
with the list of source files which will be used to build the shared
library. There is actually only one file called <span
 style="font-style: italic;">roof.c</span>. This is
done with the <span style="font-weight: bold;">SET</span>
directive.<br>
Then we define the shared library to build through the directive <span
 style="font-weight: bold;">ADD_LIBRARY</span>. This
directive is passed the name of the library (<span
 style="font-style: italic;">roof</span>) to build <span
 style="font-style: italic;">libroof.so</span>, the<span
 style="font-style: italic;"> SHARED</span> keyword to specify
that it is a shared library and the list of source files which are part
of the library with the variable <span style="font-style: italic;">roof_lib_src</span>.<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">SET(roof_lib_src roof.c) </span><br
 style="font-family: monospace;">
      <br style="font-family: monospace;">
      <span style="font-family: monospace;">ADD_LIBRARY(roof
SHARED ${roof_lib_src})</span></td>
    </tr>
  </tbody>
</table>
<pre><br></pre>
<span style="font-family: monospace;"></span><span
 style="font-family: monospace;"></span>
<h3><a name="CMakeLists.txt_in_client"></a>CMakeLists.txt
in client</h3>
The directory <span style="font-style: italic;">client</span>
contains the files to make the executable <span
 style="font-style: italic;">roof</span>.<br>
<br>
We first define the target executable with <span
 style="font-weight: bold;">ADD_EXECUTABLE</span>
directive.<br>
We first assign a variable called <span style="font-style: italic;">roof_client_src</span>
with the list of source files which will be used to build the
executable. There is actually only one file called <span
 style="font-style: italic;">main.c</span>. This is
done with the <span style="font-weight: bold;">SET</span>
directive.<br>
We define the dependency of the executable called <span
 style="font-style: italic;">roof</span> with the <span
 style="font-style: italic;">libroof.so</span> through
the <span style="font-weight: bold;">TARGET_LINK_LIBRARIES</span>
directive. <span style="color: rgb(255, 0, 0);">There is
a problem here as we would like to generate an executable called</span>
<span style="font-style: italic; color: rgb(255, 0, 0);">roof</span><span
 style="color: rgb(255, 0, 0);"> and a library called </span><span
 style="font-style: italic; color: rgb(255, 0, 0);">libroof.so</span>.
Normally, the directive should be written as:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">ADD_EXECUTABLE(roof)</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">TARGET_LINK_LIBRARIES(roof
roof)</span><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><br>
But <span style="font-style: italic;">cmake</span> complains saying:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">CMake Error: Attempt to add
link target roof of type: EXECUTABLE </span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">to target
roof. You can only link to STATIC or SHARED libraries.</span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><span
 style="font-family: monospace;"><br>
<br>
</span>
In fact, <span style="font-style: italic;">cmake</span> gets confused
because it has the impression that we want
to build <span style="font-style: italic;">roof</span>
with itself. Hence the use of an intermediate name <span
 style="font-style: italic;">main</span> in the
directives <span style="font-weight: bold;">TARGET_LINK_LIBRARIES</span>
and <span style="font-weight: bold;">ADD_EXECUTABLE</span>.
Then, we tell <span style="font-style: italic;">cmake </span>to
rename the generated <span style="font-style: italic;">main</span>
executable into
<span style="font-style: italic;">roof </span>thanks to the directive <span
 style="font-weight: bold;">SET_TARGET_PROPERTIES</span>.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">SET(roof_client_src main.c) </span><br
 style="font-family: monospace;">
      <br style="font-family: monospace;">
      <span style="font-family: monospace;">ADD_EXECUTABLE(main
${roof_client_src})</span><br style="font-family: monospace;">
      <br style="font-family: monospace;">
      <span style="font-family: monospace;">TARGET_LINK_LIBRARIES(main
roof) </span><br style="font-family: monospace;">
      <span style="font-family: monospace;">SET_TARGET_PROPERTIES(main </span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PROPERTIES
OUTPUT_NAME
roof)</span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span>
<br>
<hr style="width: 100%; height: 2px;">
<h2><a name="Project_4:_Generation_and_installation"></a><span
 style="text-decoration: underline;">Project 4</span>:
Generation and installation of a program along with its manuals</h2>
<br>
The project called <span style="font-weight: bold;">PROJECT4</span>
builds an executable called <span style="font-weight: bold;">pdip</span>
and a set of Linux manuals compressed with <span
 style="font-style: italic;">gzip</span> tool.<br>
The project is spreaded in the following sub-tree (the files are
located <a
 href="http://rachid.koucha.free.fr/tech_corner/cmake_projects/project4">here</a>):<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto;"
 border="3">
  <tbody>
    <tr>
      <td
 style="text-align: left; background-color: rgb(51, 255, 51); white-space: nowrap;"><span
 style="font-family: monospace;"><span style="font-weight: bold;">project4<br>
      </span>&nbsp;&nbsp;&nbsp;|<br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;|</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;<a
 href="cmake_projects/project4/pdip.c">pdip.c</a></span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;<a
 href="cmake_projects/project4/pdip_en.1">pdip_en.1</a>&nbsp; </span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;<a
 href="cmake_projects/project4/pdip_fr.1">pdip_fr.1 </a></span><br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><br>
<br>
<span style="font-style: italic;">pdip.c</span> is
the source of the program and <span style="font-style: italic;">pdip_en.1</span>
and <span style="font-style: italic;">pdip_fr.1</span>
are respectively the english and french manuals.<br>
The following sub-tree shows the files that have been added to build
the project.<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto;"
 border="3">
  <tbody>
    <tr>
      <td
 style="text-align: left; vertical-align: middle; background-color: rgb(51, 255, 51); white-space: nowrap;"><span
 style="font-family: monospace;">&nbsp;<span style="font-weight: bold;">project4<br>
      </span><span style="font-family: monospace;">&nbsp; &nbsp;&nbsp;|</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; |</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; <a
 href="cmake_projects/project4/pdip.c">pdip.c</a></span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; <a
 href="cmake_projects/project4/pdip_en.1">pdip_en.1</a></span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; <a
 href="cmake_projects/project4/pdip_fr.1">pdip_fr.1</a></span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;</span><a
 style="font-family: monospace;"
 href="cmake_manual.html#FindGZIP.cmake_in_pdip">FindGZIP.cmake</a><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;</span><a
 style="font-family: monospace;"
 href="cmake_manual.html#CMakeLists.txt_in_pdip">CMakeLists.txt</a><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;</span><a
 style="font-family: monospace;"
 href="cmake_manual.html#pdip_chown.cmake_in_pdip">pdip_chown.cmake</a><br
 style="font-family: monospace;">
      </span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;">&nbsp; &nbsp;<br>
<br>
</span>To generate the build environment:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ cd project4<br
 style="font-family: monospace;">
      </span><span style="font-family: monospace;">-- The C compiler
identification is GNU<br>
-- Check for working C compiler: /usr/bin/gcc<br>
-- Check for working C compiler: /usr/bin/gcc -- works<br>
-- Detecting C compiler ABI info<br>
-- Detecting C compiler ABI info - done<br>
-- Configuring done<br>
-- Generating done<br>
-- Build files have been written to: .../project4<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><br
 style="font-family: monospace;">
<br>
To trigger the build:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"></span><span
 style="font-family: monospace;">[ 33%] Building pdip_fr.1.gz<br>
[ 66%] Building
pdip_en.1.gz<br>
Scanning dependencies of target
pdip<br>
[100%] Building C object
CMakeFiles/pdip.dir/pdip.c.o<br>
Linking C executable
pdip<br>
[100%] Built target pdip <br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><span
 style="font-family: monospace;"></span><br
 style="font-family: monospace;">
<br>
To trigger the installation of the software:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make install</span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><br
 style="font-family: monospace;">
<br>
After it is possible to clean-up anything generated by the <span
 style="font-style: italic;">cmake</span>
environment with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make clean</span></td>
    </tr>
  </tbody>
</table>
<br>
<h3><a name="FindGZIP.cmake_in_pdip"></a>FindGZIP.cmake
in project4</h3>
As the project needs to install the manuals in compressed format, we
use the directive <span style="font-weight: bold;">FIND_PROGRAM</span>
to check the presence of the <span style="font-style: italic;">gzip</span>
tool (specified after <span style="font-weight: bold;">NAMES</span>
keyword). The directive is passed the list of directories to find into (<span
 style="font-style: italic;">/bin</span>, <span
 style="font-style: italic;">/usr/bin</span> and <span
 style="font-style: italic;">/usr/local/bin</span>).
The result of the command goes into the variable <span
 style="font-weight: bold;">GZIP_TOOL</span> passed as
first parameter of the directive. If <span style="font-style: italic;">gzip</span>
is found, its
path is stored into the variable <span style="font-weight: bold;">GZIP_TOOL</span>.
If
it
is
not
found,
<span style="font-weight: bold;">GZIP_TOOL</span>
is assigned with <span style="font-weight: bold;">GZIP_TOOL-NOTFOUND</span>.<br>
<br>
The result of the search is checked with the <span
 style="font-weight: bold;">IF</span>
directive which returns true if the variable's value is not empty, <span
 style="font-weight: bold;">0</span>,
&nbsp;<span style="font-weight: bold;">N</span>, <span
 style="font-weight: bold;">NO</span>, <span style="font-weight: bold;">OFF</span>,
<span style="font-weight: bold;">FALSE</span>, <span
 style="font-weight: bold;">NOTFOUND</span> or
<span style="font-weight: bold;">&lt;variable&gt;-NOTFOUND</span>. If
the
test is false, a message is displayed thanks to the <span
 style="font-weight: bold;">MESSAGE</span> directive
with a weight set to <span style="font-weight: bold;">FATAL_ERROR</span>
to stop any future processing. <br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">FIND_PROGRAM(GZIP_TOOL</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NAMES
gzip</span><br style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PATHS
/bin</span><br style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;/usr/bin</span><br style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;/usr/local/bin</span><span
 style="font-family: monospace;">)</span><br
 style="font-family: monospace;">
      <br style="font-family: monospace;">
      <br style="font-family: monospace;">
      <span style="font-family: monospace;">IF(NOT
GZIP_TOOL)</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
MESSAGE(FATAL_ERROR "Unable to find 'gzip' program") </span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">ENDIF(NOT
GZIP_TOOL)</span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><span
 style="font-family: monospace;"></span><br>
<h3><a name="CMakeLists.txt_in_pdip"></a>CMakeLists.txt
in project4</h3>
This project contains only one <span style="font-style: italic;">CMakeLists.txt</span>
file.<br>
We define the minimum version of <span style="font-style: italic;">cmake</span>
that we support for this project through the directive <span
 style="font-weight: bold;">CMAKE_MINIMUM_REQUIRED</span>.<br>
The project's name <span style="font-style: italic;">project4</span>
as well as the used programming language (<span
 style="font-style: italic;">C</span>) are declared
with the directive <span style="font-weight: bold;">PROJECT</span>.<br>
Then we include the file <a href="#FindGZIP.cmake_in_pdip">FindGZIP.cmake</a>
&nbsp;to trigger the search of the <span style="font-style: italic;">gzip</span>
tool (<span style="font-weight: bold;">INCLUDE</span> directive<span
 style="font-weight: bold;"></span>).<br>
If <span style="font-style: italic;">gzip</span>
tool has been found, its pathname is stored in the variable <span
 style="font-style: italic;">GZIP_TOOL</span>.<br>
Three variables are set with the <span style="font-weight: bold;">SET</span>
directive:<br>
<ul>
  <li><span style="font-style: italic;">pdip_src</span>
is the list of source files to compile (<span
 style="font-style: italic;">pdip.c</span>)</li>
  <li><span style="font-style: italic;">pdip_exe</span>
is the name of the output executable (<span style="font-style: italic;">pdip</span>)</li>
  <li><span style="font-style: italic;">pdip_man_src</span> is the list
of manuals to compress (<span style="font-style: italic;">pdip_en.1</span>
and <span style="font-style: italic;">pdip_fr.1</span>)</li>
  <li><span style="font-style: italic;">pdip_man_gz</span>
is the list of compressed manuals</li>
</ul>
In the loop (<span style="font-weight: bold;">FOREACH</span>
directive), we define the targets of the manuals and the way to build
them through the directive <span style="font-weight: bold;">ADD_CUSTOM_COMMAND</span>.
This
directive
also
lists
the
dependencies
(<span style="font-weight: bold;">DEPENDS</span>)
of
the
target
to trigger the build only if the source manuals have been
modified. The <span style="font-weight: bold;">COMMENT</span>
tag is useful to make <span style="font-style: italic;">cmake</span>
display the string "Building pdip_....1.gz"
while triggering the command.<br>
<br>
We define the flags that will be passed as arguments to the compiler
through the <span style="font-weight: bold;">ADD_DEFINITIONS</span>
directive. It is optional to do it but the default flags passed to the
compiler are not sufficiently severe to check and report the warnings
and bugs.<br>
<br>
The entry point of the build is the <span style="font-weight: bold;">ADD_EXECUTABLE</span>
directive which specifies that the output program <span
 style="font-style: italic;">pdip</span> depends on the
source code <span style="font-style: italic;">pdip.c</span>
and the&nbsp;compressed manuals <span style="font-style: italic;">pdip_en.1.gz</span>
and <span style="font-style: italic;">pdip_fr.1.gz</span>.<br>
<br>
The following directives describe the installation of the software. The
installation is done from the directory specified by the content of
the variable <span style="font-weight: bold;">CMAKE_INSTALL_PREFIX</span>.
It
defaults
to
<span style="font-style: italic;">/usr/local</span>:<br>
<ul>
  <li><span style="font-style: italic;">pdip</span>
is installed in the <span style="font-style: italic;">bin</span>
sub-directory with the appropriate permissions</li>
  <li>The compressed manuals are installed in <span
 style="font-style: italic;">share/man/...</span></li>
</ul>
<span style="font-style: italic;">cmake</span> does not provide any
facilities to change the owner and group
identifiers. We must specify a script to launch at the end of the
installation with the directive <span style="font-weight: bold;">INSTALL(SCRIPT...)</span>.
The
script&nbsp;called
<span style="font-style: italic;">pdip_chown.cmake</span>
is written in <span style="font-style: italic;">cmake</span>
language and merely changes the owner and group to
root by calling the shell <span style="font-style: italic;">chown</span>
and <span style="font-style: italic;">chgrp</span>
programs through the directive <span style="font-weight: bold;">EXECUTE_PROCESS</span>.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">CMAKE_MINIMUM_REQUIRED(VERSION 2.6)<br>
      </span><br>
      <span style="font-family: monospace;">PROJECT(project4 C)<br>
      <br>
# Search for gzip program<br>
INCLUDE (FindGZIP.cmake)<br>
      <br>
SET(pdip_src pdip.c)<br>
SET(pdip_exe pdip)<br>
SET(pdip_man_src pdip_en.1 pdip_fr.1)<br>
SET(pdip_man_gz pdip_en.1.gz pdip_fr.1.gz)<br>
      <br>
# Compression of the manuals<br>
FOREACH(man ${pdip_man_src})<br>
&nbsp; ADD_CUSTOM_COMMAND(OUTPUT ${man}.gz<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
COMMAND
${GZIP_TOOL}
-c
${man}
&gt;
${man}.gz<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DEPENDS
${man}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
COMMENT
"Building
${man}.gz")<br>
ENDFOREACH(man)<br>
      <br>
# Compilation options passed to the compiler<br>
ADD_DEFINITIONS(-g
-O2 -fsigned-char -freg-struct-return -Wall -W -Wshadow
-Wstrict-prototypes -Wpointer-arith -Wcast-qual -Winline -Werror)<br>
      <br>
# Build of the program<br>
ADD_EXECUTABLE(${pdip_exe} ${pdip_src} ${pdip_man_gz})<br>
      <br>
# Installation of the program<br>
INSTALL(TARGETS pdip<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DESTINATION "bin"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PERMISSIONS OWNER_READ
OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE)<br>
      <br>
# Installation of the manuals<br>
INSTALL(FILES pdip_fr.1.gz<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DESTINATION "share/man/fr/man1"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PERMISSIONS OWNER_READ GROUP_READ WORLD_READ RENAME pdip.1.gz)<br>
INSTALL(FILES pdip_en.1.gz<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DESTINATION "share/man/man1"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PERMISSIONS OWNER_READ GROUP_READ WORLD_READ RENAME pdip.1.gz)<br>
      <br>
# Script to be executed at installation time (kind of post-intallation
script) to<br>
# change the right accesses on the installed files<br>
INSTALL(SCRIPT pdip_chown.cmake)</span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"><br>
</span>
<h3><a name="pdip_chown.cmake_in_pdip"></a>pdip_chown.cmake
in project4<br>
</h3>
<span style="font-family: monospace;"><br>
</span>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;"># Copy the files to the
destination directory</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">EXECUTE_PROCESS(COMMAND
chown root ${CMAKE_INSTALL_PREFIX}/bin/pdip</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; COMMAND chgrp root ${CMAKE_INSTALL_PREFIX}/bin/pdip</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMMAND chown
root
${CMAKE_INSTALL_PREFIX}/share/man/fr/man1/pdip.1.gz</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMMAND chgrp
root
${CMAKE_INSTALL_PREFIX}/share/man/fr/man1/pdip.1.gz</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMMAND chown
root
${CMAKE_INSTALL_PREFIX}/share/man/man1/pdip.1.gz</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMMAND chgrp
root
${CMAKE_INSTALL_PREFIX}/share/man/man1/pdip.1.gz)</span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><span
 style="font-family: monospace;"></span><br>
<hr style="width: 100%; height: 2px;"><br>
<h2><a name="Project_5:_Installation_of_an_executable"></a><span
 style="text-decoration: underline;">Project 5</span>:
Installation of an executable and an API in a shared
library along with the include files and manuals</h2>
The project called <span style="font-weight: bold;">ROOF</span>
is composed with the following sub-tree:<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto;"
 border="3">
  <tbody>
    <tr>
      <td
 style="text-align: left; vertical-align: middle; background-color: rgb(51, 255, 51); white-space: nowrap;"><span
 style="font-family: monospace;"><span style="font-family: monospace;">&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;


































      </span><span style="font-family: monospace; font-weight: bold;">&nbsp;&nbsp;
&nbsp;<big>roof</big><br>
      </span><span style="font-family: monospace;">&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;&nbsp;
&nbsp;/ &nbsp;
| &nbsp;\ &nbsp; &nbsp; &nbsp; &nbsp;\<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp; /
&nbsp;&nbsp;&nbsp;| &nbsp; \ &nbsp; &nbsp;
&nbsp; &nbsp;\<br>
&nbsp;
&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;/ &nbsp;
&nbsp; | &nbsp; &nbsp;\ &nbsp; &nbsp;
&nbsp;&nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp; &nbsp;&nbsp; / &nbsp;
&nbsp;&nbsp;&nbsp;| &nbsp; &nbsp; \ &nbsp;
&nbsp; &nbsp; &nbsp;\</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp; &nbsp; / &nbsp; &nbsp; &nbsp;
| &nbsp; &nbsp; &nbsp;\ &nbsp; &nbsp;
&nbsp;&nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp;&nbsp; / &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;| &nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; &nbsp;\</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp;&nbsp; &nbsp;/ &nbsp; &nbsp; &nbsp;
&nbsp;
| &nbsp; &nbsp; &nbsp;&nbsp; \ &nbsp; &nbsp;
&nbsp;&nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;
&nbsp; / &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
| &nbsp; &nbsp; &nbsp; &nbsp; \ &nbsp; &nbsp;
&nbsp; &nbsp;\</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; </span><span style="font-weight: bold; font-family: monospace;">lib</span><small
 style="font-family: monospace;"> &nbsp; &nbsp;
&nbsp; &nbsp;</small><span
 style="font-weight: bold; font-family: monospace;">client</span><small
 style="font-family: monospace;"> &nbsp;&nbsp;<span
 style="font-weight: bold;"><big>include
&nbsp;&nbsp; man</big></span></small><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp;| &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;| &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;| &nbsp; &nbsp; &nbsp;
&nbsp;|</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
&nbsp;&nbsp;&nbsp;|&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; |
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;
&nbsp; &nbsp; &nbsp;|</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;
roof.c &nbsp; &nbsp;&nbsp;&nbsp;main.c &nbsp;
&nbsp;roof.h &nbsp; &nbsp;roof.1</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;
roof_p.h &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;roof.3<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;roof.7</span><br style="font-family: monospace;">
      </span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;">&nbsp;
&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><br>
The project generates the following targets:<br>
<ul>
  <li>A&nbsp;shared library called <span style="font-weight: bold;">libroof.so</span></li>
  <li>An executable called <span style="font-weight: bold;">roof</span></li>
  <li>A bunch of compressed Linux on-line manuals<span
 style="font-style: italic;"></span></li>
</ul>
<br>
The following sub-tree shows the files that have been added to build
the project.<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto;"
 border="3">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(51, 255, 51); white-space: nowrap;"><span
 style="font-family: monospace;">&nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;
&nbsp; &nbsp; <span style="font-weight: bold;">&nbsp;
&nbsp; &nbsp; &nbsp;<big>roof</big><br>
      </span><span style="font-family: monospace;">&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;/ &nbsp; &nbsp; &nbsp; &nbsp;
| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; &nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp; /
&nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; \ &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; \ &nbsp; &nbsp;
&nbsp; &nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;/ &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; \ &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; \ &nbsp; &nbsp; &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; &nbsp; &nbsp;
/ &nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;| &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; &nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;/ &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; \ &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; \ &nbsp; &nbsp; &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; &nbsp; /
&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;| &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; \ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; \ &nbsp; &nbsp; &nbsp; &nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;&nbsp;&nbsp;/
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
| &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; &nbsp; \</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; / &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \
&nbsp; &nbsp; &nbsp; &nbsp; \</span><br style="font-family: monospace;">
&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;">lib</span><small>
&nbsp; &nbsp; &nbsp; &nbsp;</small><span style="font-weight: bold;">
&nbsp; &nbsp;
&nbsp;client</span><small> &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold;"><big>include</big>
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <big>man
&nbsp; </big></span><a href="#CMakeLists.txt_in_roof_3"><big>CMakeLists.txt</big></a></small><br>
      <span style="font-family: monospace;">&nbsp;&nbsp; &nbsp;| &nbsp;
&nbsp;
&nbsp;&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;|</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;&nbsp;|&nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; |</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;roof.c &nbsp;
&nbsp;&nbsp; &nbsp;
&nbsp; &nbsp; main.c &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; roof.h &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;roof.1</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; roof_p.h &nbsp;
&nbsp; &nbsp;
&nbsp;&nbsp; </span></span><a style="font-family: monospace;"
 href="#CMakeLists.txt_in_client_3"><small><big>CMakeLists.txt</big></small></a><span
 style="font-family: monospace;"> &nbsp; <a
 href="#CMakeLists.txt_in_include_3">CMakeLists.txt</a>&nbsp;
roof.3<br>
&nbsp; </span><a style="font-family: monospace;"
 href="#CMakeLists.txt_in_lib_3"><small><big>CMakeLists.txt</big></small></a><span
 style="font-family: monospace;"><span style="font-family: monospace;">
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; ...</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;roof.7</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;</span><a style="font-family: monospace;"
 href="#CMakeLists.txt_in_man_3">CMakeLists.txt</a><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;</span><a style="font-family: monospace;"
 href="#FindGZIP.cmake_in_man_3">FindGZIP.cmake</a><br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><br>
<br>
Once the <span style="font-style: italic;">cmake</span>
files are setup, launch <span style="font-style: italic;">cmake</span>
to generate the build
environment (with <span style="font-style: italic;">/tmp</span>
as target installation directory instead of the default <span
 style="font-style: italic;">/usr/local</span>):<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ cd roof</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">$ cmake .
-DCMAKE_INSTALL_PREFIX=/tmp</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">-- Configuring
done</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">-- Generating
done</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">-- Build files
have been written to: .../roof</span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><span
 style="font-family: monospace;"></span><br
 style="font-family: monospace;">
<br style="font-family: monospace;">
Then, the makefiles are ready to trigger a build with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">[ 50%]
Building C object bin/CMakeFiles/roof.dir/roof.o</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">Linking C
shared library libroof.so</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">[ 50%] Built
target roof</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">[100%]
Building C object bin/CMakeFiles/main.dir/main.o</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">Linking C
executable roof</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">[100%] Built
target main</span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><span
 style="font-family: monospace;"></span><br>
To install the files in&nbsp;<span style="font-style: italic;">/tmp</span>,
just
invoke:<br>
<br style="font-family: monospace;">
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make install<br>
[&nbsp; 3%] Built target roof<br>
[&nbsp; 7%] Built target main<br>
[100%] Built target man<br>
Install the project...<br>
-- Install configuration: ""<br>
-- Install configuration: ""<br>
-- Installing /tmp/lib/libroof.so.1.0.0<br>
-- Install configuration: ""<br>
-- Installing /tmp/bin/roof<br>
-- Install configuration: ""<br>
-- Installing /tmp/share/man/man1/roof.1.gz<br>
-- Installing /tmp/share/man/man3/roof_cwd.3.gz<br>
-- Installing /tmp/share/man/man3/roof_login.3.gz<br>
...</span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><br>
After it is possible to clean-up anything generated by the <span
 style="font-style: italic;">cmake</span>
environment with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make clean</span></td>
    </tr>
  </tbody>
</table>
<br>
<h2><a name="CMakeLists.txt_in_roof_3"></a>CMakeLists.txt
in roof</h2>
The directory <span style="font-style: italic;">roof</span>
is the top directory of the project. This is the place where we launch
the <span style="font-style: italic;">cmake</span>
command.<br>
<br>
This is the top <span style="font-style: italic;">CMakeLists.txt</span>
of the project.<br>
We define the minimum version of <span style="font-style: italic;">cmake</span>
that we support for this project through the directive <span
 style="font-weight: bold;">CMAKE_MINIMUM_REQUIRED</span>.<br>
We identify the project as well as the programming language with the <span
 style="font-weight: bold;">PROJECT</span> directive.<br>
We specify the directories where are located the include files (<span
 style="font-style: italic;">include</span> and <span
 style="font-style: italic;">lib</span>) with the <span
 style="font-weight: bold;">INCLUDE_DIRECTORIES</span>
directive.<br>
We define the flags that will be passed as arguments to the compiler
through the <span style="font-weight: bold;">ADD_DEFINITIONS</span>
directive. It is optional to do it but the default flags passed to the
compiler are not sufficiently severe to check and report the warnings
and bugs.<br>
We specify the list of sub-directories where are located the sources to
build (<span style="font-style: italic;">lib</span>,
<span style="font-style: italic;">client, man </span>and<span
 style="font-style: italic;"> include</span>) with the <span
 style="font-weight: bold;">ADD_SUBDIRECTORY</span>
directive. We don't specify a directory (second argument of
<span style="font-weight: bold;">ADD_SUBDIRECTORY</span>) where to put
all the binaries because we faced some
problems for the installation of the shared library (Bug in <span
 style="font-style: italic;">cmake</span> ?).<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="white-space: nowrap; background-color: rgb(255, 204, 0);"><span
 style="font-family: monospace;">CMAKE_MINIMUM_REQUIRED(VERSION 2.6)<br>
      <br>
      </span><span style="font-family: monospace;">PROJECT(roof C)<br>
      <br>
INCLUDE_DIRECTORIES(include lib)<br>
      <br>
ADD_DEFINITIONS(-g -O2 -fsigned-char -freg-struct-return -Wall -W
-Wshadow -Wstrict-prototypes -Wpointer-arith -Wcast-qual -Winline
-Werror)<br>
      <br>
ADD_SUBDIRECTORY(lib)<br>
ADD_SUBDIRECTORY(client)<br>
ADD_SUBDIRECTORY(man)<br>
ADD_SUBDIRECTORY(include)<br>
      <br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
<h2><a name="CMakeLists.txt_in_lib_3"></a>CMakeLists.txt
in lib</h2>
The directory <span style="font-style: italic;">lib</span>
contains all the files to make the library <span
 style="font-style: italic;">libroof.so</span>.<br>
<br>
We define the shared library to build through the directive <span
 style="font-weight: bold;">ADD_LIBRARY</span>. This
directive is passed the name of the library (<span
 style="font-style: italic;">roof</span>) to build <span
 style="font-style: italic;">libroof.so</span>, the<span
 style="font-style: italic;"> SHARED</span> keyword to specify
that it is a shared library and the list of source files which are part
of the library: <span style="font-style: italic;">roof.c</span>.<br>
We define the build version (<span style="font-weight: bold;">VERSION</span>)
and
the
API
version
(<span style="font-weight: bold;">SOVERSION</span>)
of the library through the <span style="font-weight: bold;">SET_TARGET_PROPERTIES</span>
directive.<br>
The installation of the library is specified with the&nbsp;<span
 style="font-weight: bold;">INSTALL</span> directive.
It is said that the destination directory from the installation tree
will be <span style="font-style: italic;">lib</span>.
The installation tree is specified by the variable <span
 style="font-weight: bold;">CMAKE_INSTALL_PREFIX</span>.
By default, it is <span style="font-style: italic;">/usr/local</span>.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;"># Make shared library
libroof.so from 'roof.c'<br>
ADD_LIBRARY(roof SHARED roof.c)<br>
      <br>
# Set the build version (VERSION) and the API version (SOVERSION)<br>
SET_TARGET_PROPERTIES(roof<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PROPERTIES<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
VERSION
1.0.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
SOVERSION
1)<br>
      <br>
# Installation of the library<br>
INSTALL(TARGETS roof<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DESTINATION lib<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PERMISSIONS OWNER_READ GROUP_READ WORLD_READ)<br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
<h2><a name="CMakeLists.txt_in_client_3"></a>CMakeLists.txt
in client</h2>
The directory <span style="font-style: italic;">client</span>
contains the files to make the executable <span
 style="font-style: italic;">roof</span>.<br>
<br>
We first define the target executable <span style="font-style: italic;">roof</span>
with <span style="font-weight: bold;">ADD_EXECUTABLE</span>
directive.<br>
We define the dependency of the executable <span
 style="font-style: italic;"></span>with the <span
 style="font-style: italic;">libroof.so</span> through
the <span style="font-weight: bold;">TARGET_LINK_LIBRARIES</span>
directive. <span style="color: rgb(255, 0, 0);">There is
a problem here as we would like to generate an executable called</span>
<span style="font-style: italic; color: rgb(255, 0, 0);">roof</span><span
 style="color: rgb(255, 0, 0);"> and a library called </span><span
 style="font-style: italic; color: rgb(255, 0, 0);">libroof.so</span>.
Normally, the directive should be written as:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">ADD_EXECUTABLE(roof)</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">TARGET_LINK_LIBRARIES(roof
roof)</span><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"></span><br>
But <span style="font-style: italic;">cmake</span> complains saying:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">CMake Error: Attempt to add
link target roof of type: EXECUTABLE </span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">to target
roof. You can only link to STATIC or SHARED libraries.</span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"><br>
<br>
</span>
In fact, <span style="font-style: italic;">cmake</span>
gets confused because it has the impression that we want
to build <span style="font-style: italic;">roof</span>
with itself. Hence the use of an intermediate name <span
 style="font-style: italic;">main</span> in the
directives <span style="font-weight: bold;">TARGET_LINK_LIBRARIES</span>
and <span style="font-weight: bold;">ADD_EXECUTABLE</span>.
Then, we tell <span style="font-style: italic;">cmake</span>
to rename the generated <span style="font-style: italic;">main</span>
executable into
<span style="font-style: italic;">roof</span> thanks to the directive <span
 style="font-weight: bold;">SET_TARGET_PROPERTIES</span>.
<br>
<br>
The installation of the program is specified with the&nbsp;<span
 style="font-weight: bold;">INSTALL</span> directive.
It is said that the destination directory from the installation tree
will be <span style="font-style: italic;">bin</span>.
The installation tree is specified by the variable <span
 style="font-weight: bold;">CMAKE_INSTALL_PREFIX</span>.
By default, it is <span style="font-style: italic;">/usr/local</span>.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;"># 'main' depends on some C
source files<br>
ADD_EXECUTABLE(main main.c)<br>
      <br>
# 'main' depends on libroof.so<br>
TARGET_LINK_LIBRARIES(main roof)<br>
      <br>
# In the preceding rules, we can't use 'roof' as target name otherwise<br>
# cmake will return in error with TARGET_LINK_LIBRARIES(roof roof):<br>
#<br>
#&nbsp;&nbsp;&nbsp; CMake Error: Attempt to add link target
roof of type: EXECUTABLE<br>
#&nbsp;&nbsp;&nbsp; to target roof. You can only link to
STATIC or SHARED libraries.<br>
#<br>
# Hence the SET_TARGET_PROPERTIES to rename main to roof<br>
#<br>
SET_TARGET_PROPERTIES(main<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PROPERTIES
OUTPUT_NAME
roof)<br>
      <br>
# Installation of the program<br>
INSTALL(TARGETS main<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
RUNTIME<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DESTINATION bin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PERMISSIONS OWNER_READ
OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE)<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
<h2><a name="CMakeLists.txt_in_include_3"></a>CMakeLists.txt
in include</h2>
The installation of the include files is specified with the&nbsp;<span
 style="font-weight: bold;">INSTALL</span> directive.
It is said that the destination directory from the installation tree
will be <span style="font-style: italic;">include</span>.
The installation tree is specified by the variable <span
 style="font-weight: bold;">CMAKE_INSTALL_PREFIX</span>.
By default, it is <span style="font-style: italic;">/usr/local</span>.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">INSTALL(FILES roof.h<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DESTINATION include<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PERMISSIONS OWNER_READ GROUP_READ WORLD_READ)<br>
      <br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
<h2><a name="FindGZIP.cmake_in_man_3"></a>FindGZIP.cmake
in man</h2>
As the project needs to install the manuals in compressed format, we
use the directive <span style="font-weight: bold;">FIND_PROGRAM</span>
to check the presence of the <span style="font-style: italic;">gzip</span>
tool (specified after <span style="font-weight: bold;">NAMES</span>
keyword). The directive is passed the list of directories to find into (<span
 style="font-style: italic;">/bin</span>, <span
 style="font-style: italic;">/usr/bin</span> and <span
 style="font-style: italic;">/usr/local/bin</span>).
The result of the command goes into the variable <span
 style="font-weight: bold;">GZIP_TOOL</span> passed as
first parameter of the directive. If <span style="font-style: italic;">gzip</span>
is found, its
path is stored into the variable <span style="font-weight: bold;">GZIP_TOOL</span>.
If
it
is
not
found,
<span style="font-weight: bold;">GZIP_TOOL</span>
is assigned with <span style="font-weight: bold;">GZIP_TOOL-NOTFOUND</span>.<br>
<br>
The result of the search is checked with the <span
 style="font-weight: bold;">IF</span>
directive which returns TRUE if the variable's value is not empty, <span
 style="font-weight: bold;">0</span>,
&nbsp;<span style="font-weight: bold;">N</span>, <span
 style="font-weight: bold;">NO</span>, <span style="font-weight: bold;">OFF</span>,
<span style="font-weight: bold;">FALSE</span>, <span
 style="font-weight: bold;">NOTFOUND</span> or
<span style="font-weight: bold;">&lt;variable&gt;-NOTFOUND</span>. If
the
test is FALSE, a message is displayed thanks to the <span
 style="font-weight: bold;">MESSAGE</span> directive
with a weight set to <span style="font-weight: bold;">FATAL_ERROR</span>
to stop any future processing. <br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">FIND_PROGRAM(GZIP_TOOL</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NAMES
gzip</span><br style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PATHS
/bin</span><br style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;/usr/bin</span><br style="font-family: monospace;">
      <span style="font-family: monospace;"> &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;/usr/local/bin</span><span
 style="font-family: monospace;">)</span><br
 style="font-family: monospace;">
      <br style="font-family: monospace;">
      <br style="font-family: monospace;">
      <span style="font-family: monospace;">IF(NOT
GZIP_TOOL)</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;
MESSAGE(FATAL_ERROR "Unable to find 'gzip' program") </span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">ENDIF(NOT
GZIP_TOOL)</span></td>
    </tr>
  </tbody>
</table>
<br>
<h2><a name="CMakeLists.txt_in_man_3"></a>CMakeLists.txt
in man</h2>
We first include the script <a href="#FindGZIP.cmake_in_man_3">FindGZIP.cmake</a>
to check the presence of <span style="font-style: italic;">gzip</span>
tool.<br>
We use <span style="font-weight: bold;">SET</span>
directive to set three variables with the list of source manuals.<br>
Thanks to the string manipulation directive <span
 style="font-weight: bold;">STRING</span> on the preceding
variables, we define three other variables containing the list of
compressed manuals (suffix <span style="font-style: italic;">.gz</span>).<br>
For each source manual, we use <span style="font-weight: bold;">ADD_CUSTOM_COMMAND</span>
to generate the specific command which will compress the source manuals.<br>
We define the target <span style="font-style: italic;">man</span> to
be added to the default build target so
that it will be run every time through the directive <span
 style="font-weight: bold;">ADD_CUSTOM_TARGET</span>.
But we make it depend on the source manuals to avoid rebuilding the
manuals each time we invoke <span style="font-style: italic;">make</span>.<br>
The installation of the compressed manuals&nbsp;is specified with
the&nbsp;<span style="font-weight: bold;">INSTALL</span>
directives. It is said that the destination directory from the
installation tree will be <span style="font-style: italic;">share/man/manX</span>.
The
installation
tree
is
specified
by
the
variable
<span style="font-weight: bold;">CMAKE_INSTALL_PREFIX</span>.
By
default,
it
is
<span style="font-style: italic;">/usr/local</span>.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;"># Search for gzip program<br>
INCLUDE (FindGZIP.cmake)<br>
      <br>
# Lists of source manuals<br>
SET(roof_man_src_1 roof.1)<br>
SET(roof_man_src_3 roof_cwd.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_login.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_pwd.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_syst.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_delete.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_mkdir.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_retr.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_type.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_get_debug_level.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_mv.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_rm.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_get_reply.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_new.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_rmdir.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_cdup.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_initialize.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_nlst.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_set_debug_level.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_close_ctrl.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_list.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_open_ctrl.3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
roof_stor.3)<br>
SET(roof_man_src_7 roof.7)<br>
      <br>
# Lists of compressed manuals<br>
STRING(REGEX REPLACE ".1" ".1.gz" roof_man_gz_1 "${roof_man_src_1}")<br>
STRING(REGEX REPLACE ".3" ".3.gz" roof_man_gz_3 "${roof_man_src_3}")<br>
STRING(REGEX REPLACE ".7" ".7.gz" roof_man_gz_7 "${roof_man_src_7}")<br>
      <br>
      <br>
# Compression of the manuals<br>
FOREACH(man ${roof_man_src_1} ${roof_man_src_3} ${roof_man_src_7})<br>
&nbsp; ADD_CUSTOM_COMMAND(OUTPUT ${man}.gz<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
COMMAND
${GZIP_TOOL}
-c
${man}
&gt;
${man}.gz<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DEPENDS
${man}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
COMMENT
"Building
${man}.gz")<br>
ENDFOREACH(man)<br>
      <br>
# Add the manual generation in the global rules<br>
ADD_CUSTOM_TARGET(man ALL<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; DEPENDS ${roof_man_gz_1}
${roof_man_gz_3} ${roof_man_gz_7})<br>
      <br>
# Installation of the manuals<br>
INSTALL(FILES ${roof_man_gz_1}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DESTINATION "share/man/man1"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PERMISSIONS OWNER_READ GROUP_READ WORLD_READ)<br>
INSTALL(FILES ${roof_man_gz_3}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DESTINATION "share/man/man3"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PERMISSIONS OWNER_READ GROUP_READ WORLD_READ)<br>
INSTALL(FILES ${roof_man_gz_7}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DESTINATION "share/man/man7"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PERMISSIONS OWNER_READ GROUP_READ WORLD_READ)<br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
<hr style="width: 100%; height: 2px;">
<h2><a name="Project_6:_Packaging_of_a_project"></a><span
 style="text-decoration: underline;">Project 6</span>:
Packaging of a project</h2>
On this <a href="http://www.cmake.org/HTML/cpack-2.6.html">resource</a>,
it
is
explained
how
to
package
a
project.
Loosely
speaking,
<span style="font-style: italic;">cmake</span>
is
associated to the <span style="font-style: italic;">CPack</span>
tool to manage the packages. For the moment,
the DEB or RPM packages are not supported. Only the following format
are available:<br>
<ul>
  <li>STGZ: Self extracting Tar GZip compression</li>
  <li>TBZ2: Tar BZip2 compression</li>
  <li>TGZ: Tar GZip compression</li>
  <li>TZ: Tar Compress compression</li>
  <li>ZIP: ZIP file format</li>
</ul>
<br>
In this project, we generate a package for <a
 href="#Project_5:_Installation_of_an_executable">project 5</a>.
We just need to add the directive <span style="font-weight: bold;">INCLUDE(CPack)</span>
in the top <span style="font-style: italic;">CMakeLists.txt</span>
file. Optionally, it is possible to set some configuration variables
for <span style="font-style: italic;">CPack</span>
like <span style="font-weight: bold;">CPACK_PACKAGE_VERSION_MAJOR</span>,
<span style="font-weight: bold;">CPACK_PACKAGE_VERSION_MINOR</span>,
<span style="font-weight: bold;">CPACK_PACKAGE_VERSION_PATCH</span>...<span
 style="font-family: monospace;"><span style="color: rgb(255, 0, 0);"></span></span><br>
This generates a new target called&nbsp;<i>package</i>
in the build system.
When this target is built, <span style="font-style: italic;">CPack</span>
is invoked to generate all of the
packages. Internally, <span style="font-style: italic;">CPack</span>
uses the CMake's install directives to
make the package. <br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="white-space: nowrap; background-color: rgb(255, 204, 0);"><span
 style="font-family: monospace;">CMAKE_MINIMUM_REQUIRED(VERSION 2.6)<br>
      </span><br>
      <span style="font-family: monospace;">PROJECT(roof C)<br>
      <br>
INCLUDE_DIRECTORIES(include lib)<br>
      <br>
ADD_DEFINITIONS(-g -O2 -fsigned-char -freg-struct-return -Wall -W
-Wshadow -Wstrict-prototypes -Wpointer-arith -Wcast-qual -Winline
-Werror)<br>
      <br>
ADD_SUBDIRECTORY(lib)<br>
ADD_SUBDIRECTORY(client)<br>
ADD_SUBDIRECTORY(man)<br>
ADD_SUBDIRECTORY(include)<br>
      <br>
      <span style="color: rgb(255, 0, 0);">SET(CPACK_PACKAGE_DESCRIPTION_SUMMARY
"Remote
Operations
On
Files")<br>
SET(CPACK_PACKAGE_VENDOR "Rachid Koucha")<br>
#SET(CPACK_PACKAGE_DESCRIPTION_FILE
"${CMAKE_CURRENT_SOURCE_DIR}/ReadMe.txt")<br>
SET(CPACK_RESOURCE_FILE_LICENSE "${CMAKE_CURRENT_SOURCE_DIR}/COPYING")<br>
SET(CPACK_PACKAGE_VERSION_MAJOR "1")<br>
SET(CPACK_PACKAGE_VERSION_MINOR "0")<br>
SET(CPACK_PACKAGE_VERSION_PATCH "0")<br>
SET(CPACK_PACKAGE_INSTALL_DIRECTORY "CMake
${CMake_VERSION_MAJOR}.${CMake_VERSION_MINOR}")<br>
#SET(CPACK_STRIP_FILES "bin/MyExecutable")<br>
#SET(CPACK_SOURCE_STRIP_FILES "")<br>
SET(CPACK_PACKAGE_EXECUTABLES "roof" "FTP client")<br>
INCLUDE(CPack)</span><br>
      <br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
Then,&nbsp;invoke the following to trigger the package generation:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="white-space: nowrap; background-color: rgb(255, 204, 0);"><span
 style="font-family: monospace;">$ make package<br>
[&nbsp; 3%] Built target roof<br>
[&nbsp; 7%] Built target main<br>
[100%] Built target man<br>
Linking C executable CMakeFiles/CMakeRelink.dir/roof<br>
Run CPack packaging tool...<br>
CPack: Create package using STGZ<br>
CPack: Install projects<br>
CPack: - Run preinstall target for: roof<br>
CPack: - Install project: roof<br>
CPack: Compress package<br>
CPack: Finalize package<br>
CPack: Package .../roof/<span style="color: rgb(255, 0, 0);">roof-1.0.0-Linux.sh
generated</span>.<br>
CPack: Create package using TGZ<br>
CPack: Install projects<br>
CPack: - Run preinstall target for: roof<br>
CPack: - Install project: roof<br>
CPack: Compress package<br>
CPack: Finalize package<br>
CPack: Package .../roof/<span style="color: rgb(255, 0, 0);">roof-1.0.0-Linux.tar.gz
generated</span>.<br>
CPack: Create package using TZ<br>
CPack: Install projects<br>
CPack: - Run preinstall target for: roof<br>
CPack: - Install project: roof<br>
CPack: Compress package<br>
CPack: Finalize package<br>
CPack: Package .../roof/<span style="color: rgb(255, 0, 0);">roof-1.0.0-Linux.tar.Z
generated</span>.<br>
      <br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
As we can see, this generates the STGZ, the TGZ and the TZ packages.
The packages do not contain the sources but only the binaries.<br>
<br>
Installation from the&nbsp;STGZ into <span style="font-style: italic;">/tmp</span>
directory:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="white-space: nowrap; background-color: rgb(255, 204, 0);"><span
 style="font-family: monospace;">$ ./roof-1.0.0-Linux.sh
--help<br>
Usage: ./roof-1.0.0-Linux.sh [options]<br>
Options: [defaults in brackets after descriptions]<br>
&nbsp;
--help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
print
this
message<br>
&nbsp;
--prefix=dir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
directory in which to install<br>
&nbsp; --include-subdir&nbsp; include the roof-1.0.0-Linux
subdirectory<br>
&nbsp; --exclude-subdir&nbsp; exclude the roof-1.0.0-Linux
subdirectory<br>
      <br>
$ ./roof-1.0.0-Linux.sh --prefix=/tmp --exclude-subdir<br>
roof Installer Version: 1.0.0, Copyright (c) Rachid Koucha<br>
This is a self-extracting archive.<br>
The archive will be extracted to: /tmp<br>
      <br>
Using target directory: /tmp<br>
Extracting, please wait...<br>
      <br>
Unpacking finished successfully<br>
$<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
<hr style="width: 100%; height: 2px;"><br>
<h2><span style="text-decoration: underline;"><a
 name="Project_7:_Generation_of_a_configuration"></a>Project 7</span>:
Generation of a configuration file (config.h)<br>
</h2>
The project called <span style="font-weight: bold;">PROJECT7</span>
is composed with the following sub-tree (the files are located <a
 href="http://rachid.koucha.free.fr/tech_corner/cmake_projects/project7">here</a>):<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td><span style="font-family: monospace;"><span
 style="font-family: monospace;">&nbsp;</span><span
 style="font-family: monospace; font-weight: bold;">&nbsp; <span
 style="font-family: mon;">project7</span><br>
      </span><span style="font-family: monospace;">&nbsp; &nbsp;&nbsp;
/\<br>
&nbsp;&nbsp;&nbsp;&nbsp;/
&nbsp;\<br>
&nbsp; &nbsp;/ &nbsp; &nbsp;\<br>
&nbsp;</span><span style="font-family: monospace;"><a
 href="cmake_projects/project7/main.c">main.c</a> simple</span><small
 style="font-family: monospace;"><span style="font-weight: bold;"></span></small><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"></span><span
 style="font-family: monospace;"></span></span></td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"><span
 style="font-family: monospace;"></span></span>The
project generates one target: an executable called <span
 style="font-weight: bold;">simple</span>.
All the objects are stored into the top level directory<span
 style="font-style: italic;"></span>. The file <span
 style="font-style: italic;">main.c</span> needs some configuration
macros that are located in a header file called <span
 style="font-style: italic;">config.h</span>. The latter will be built
automatically by <span style="font-style: italic;">cmake</span> as it
is setup thanks to some <span style="font-style: italic;">cmake</span>
variables.<br>
<br>
The following sub-tree shows the files that have been added to build
the project.<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto; font-family: monospace;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td>&nbsp;<span style="font-weight: bold;">&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
project7<br>
      </span><span style="font-family: monospace;">&nbsp;
&nbsp;&nbsp;&nbsp; / &nbsp;&nbsp; &nbsp; &nbsp; /
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;
&nbsp;/&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; /&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; |&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
\</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; /
&nbsp; &nbsp;&nbsp; &nbsp; /&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; /
&nbsp;&nbsp; &nbsp; &nbsp; / &nbsp;
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"><a
 href="cmake_projects/project7/main.c">main.c</a>&nbsp; </span><span
 style="font-family: monospace;"></span><a
 style="font-family: monospace;" href="#config.h.cmake_in_project7">
config.h.cmake</a><span style="font-family: monospace;">&nbsp; simple
&nbsp;</span><a style="font-family: monospace;"
 href="#CMakeLists.txt_in_project7">CMakeLists.txt</a><br
 style="font-family: monospace;">
      </td>
    </tr>
  </tbody>
</table>
<br>
<span style="font-family: monospace;"><span
 style="font-family: monospace;"></span></span>Once
the <span style="font-style: italic;">cmake</span> files are setup,
launch <span style="font-style: italic;">cmake</span>
to generate the build
environment:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ cd project7</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">$ cmake .</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">-- The C compiler
identification is GNU<br>
-- Check for working C compiler: /usr/bin/gcc<br>
-- Check for working C compiler: /usr/bin/gcc -- works<br>
-- Detecting C compiler ABI info<br>
-- Detecting C compiler ABI info - done<br>
-- Configuring done<br>
-- Generating done<br>
-- Build files have been written to: .../project7<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br style="font-family: monospace;">
Then, the makefiles are ready to trigger a build with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">Scanning dependencies of
target simple<br>
[100%] Building C object CMakeFiles/simple.dir/main.c.o<br>
Linking C executable simple&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
[100%] Built target simple<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
After it is possible to clean-up anything generated by the <span
 style="font-style: italic;">cmake</span>
environment with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make clean</span></td>
    </tr>
  </tbody>
</table>
<br>
<h3><a name="CMakeLists.txt_in_project7"></a>CMakeLists.txt
in project7</h3>
The directory <span style="font-style: italic;">project7</span>
is the top directory of the project. This is the place where we launch
the <span style="font-style: italic;">cmake</span>
command.<br>
<br>
This is the top <span style="font-style: italic;">CMakeLists.txt</span>
of the project.<br>
We define the minimum version of <span style="font-style: italic;">cmake</span>
that we support for this project through the directive <span
 style="font-weight: bold;">CMAKE_MINIMUM_REQUIRED</span>.<br>
We identify the project as well as the programming language with the <span
 style="font-weight: bold;">PROJECT</span> directive.<br>
Thanks to the <span style="font-weight: bold;">SET</span> directive,
we define a set of variables (<span style="font-style: italic;">PROJECT_NAME,
SIMPLE_VERSION</span>) that will be used to generate the file <a
 href="#config.h_in_project7"><span style="font-style: italic;">config.h</span></a>.<br>
We make the header file <a href="#config.h_in_project7"><span
 style="font-style: italic;">config.h</span></a> via the directive <span
 style="font-weight: bold;">CONFIGURE_FILE</span>. It is passed a file
skeleton (<a href="#config.h.cmake_in_project7"><span
 style="font-style: italic;">config.h.cmake</span></a>) which will be
converted into <a href="#config.h_in_project7"><span
 style="font-style: italic;">config.h</span></a> with some
substitutions.<br>
We define the flags that will be passed as arguments to the compiler
through the <span style="font-weight: bold;">ADD_DEFINITIONS</span>
directive. It is optional to do it but the default flags passed to the
compiler are not sufficiently severe to check and report the warnings
and bugs.<br>
We specify the target executable <span style="font-style: italic;">simple</span>
with
the <span style="font-weight: bold;">ADD_EXECUTABLE</span>
directive.<br>
<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">CMAKE_MINIMUM_REQUIRED(VERSION 2.6)<br>
      <br>
PROJECT(project7 C)<br>
      <br>
SET(PROJECT_NAME SIMPLE)<br>
      <br>
SET(SIMPLE_MAJOR 1)<br>
SET(SIMPLE_MINOR 8)<br>
SET(SIMPLE_PATCH 6)<br>
SET(SIMPLE_VERSION ${SIMPLE_MAJOR}.${SIMPLE_MINOR}.${SIMPLE_PATCH})<br>
      <br>
      <br>
CONFIGURE_FILE(<a href="#config.h.cmake_in_project7">config.h.cmake</a>
      <a href="#config.h_in_project7">config.h</a>)<br>
      <br>
ADD_DEFINITIONS(-g -O2 -fsigned-char -freg-struct-return -Wall -W
-Wshadow -Wstrict-prototypes -Wpointer-arith -Wcast-qual -Winline
-Werror)<br>
      <br>
ADD_EXECUTABLE(simple main.c)<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><br>
<h3><a name="config.h.cmake_in_project7"></a>config.h.cmake in project7</h3>
This file is the skeleton of <a href="#config.h_in_project7"><span
 style="font-style: italic;">config.h</span></a>: all the strings
embraced by the character @ (e.g. @PROJECT_NAME@) are substituted
by the <span style="font-style: italic;">cmake</span> variables with
the same name (e.g. ${PROJECT_NAME}).<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">//
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br>
// File&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : config.h<br>
// Description : Configuration of <span
 style="color: rgb(255, 0, 0); font-weight: bold;">@PROJECT_NAME@</span><br>
//
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br>
      <br>
#ifndef CONFIG_H<br>
#define CONFIG_H<br>
      <br>
//---------------------------------------------------------------------------<br>
// Name : SIMPLE_VERSION<br>
// Usage: Version of </span><span style="font-family: monospace;"><span
 style="color: rgb(255, 0, 0); font-weight: bold;">@PROJECT_NAME@</span></span><br>
      <span style="font-family: monospace;">//----------------------------------------------------------------------------<br>
#define SIMPLE_VERSION "<span
 style="font-weight: bold; color: rgb(255, 0, 0);">@SIMPLE_VERSION@</span>"<br>
      <br>
#endif // CONFIG_H<br>
      <br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><br>
<h3><a name="config.h_in_project7"></a>config.h in project7</h3>
The file <a href="#config.h_in_project7"><span
 style="font-style: italic;">config.h</span></a> is the result of the
substitutions done by the directive <span style="font-weight: bold;">CONFIGURE_FILE</span>
into the file <a style="font-style: italic;"
 href="#config.h.cmake_in_project7">config.h.cmake</a>.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">//
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br>
// File&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : config.h<br>
// Description : Configuration of <span
 style="font-weight: bold; color: rgb(255, 0, 0);">SIMPLE</span><br>
//
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br>
      <br>
#ifndef CONFIG_H<br>
#define CONFIG_H<br>
      <br>
//---------------------------------------------------------------------------<br>
// Name : SIMPLE_VERSION<br>
// Usage: Version of </span><span style="font-family: monospace;"><span
 style="font-weight: bold; color: rgb(255, 0, 0);">SIMPLE</span></span><br>
      <span style="font-family: monospace;">//----------------------------------------------------------------------------<br>
#define SIMPLE_VERSION "<span
 style="font-weight: bold; color: rgb(255, 0, 0);">1.8.6</span>"<br>
      <br>
#endif // CONFIG_H<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><br>
<hr style="width: 100%; height: 2px;">
<h2><a name="Project_8:_Generation_of_a_Linux_user_"></a><span
 style="text-decoration: underline;">Project 8</span>:
Generation of a Linux user space program along with its kernel module</h2>
The project called <span style="font-weight: bold;">PROJECT8</span>
is composed with the following sub-tree (the files are located <a
 href="http://rachid.koucha.free.fr/tech_corner/cmake_projects/project8">here</a>):<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td> <span style="font-family: monospace;">&nbsp;<span
 style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; project8<br>
      </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/&nbsp;&nbsp;&nbsp;&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;
\<br>
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; / &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp; / &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp; \&nbsp;&nbsp;&nbsp;&nbsp; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;
\<span style="font-weight: bold;"><br>
      </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;
\<br>
&nbsp;<a href="cmake_projects/project8/udp_console_u.c">udp_console_u.c</a>
      <a href="cmake_projects/project8/udp_console_k.c">udpc_console_k.c</a>
udpc <a href="#Kbuild_in_project8">Kbuild</a> udpc.ko </span><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
The
project generates two targets: a user space executable called <span
 style="font-weight: bold;">udpc</span> and a kernel module called <span
 style="font-weight: bold;">udpc.ko</span>.
All the objects are stored into the top level directory<span
 style="font-style: italic;"></span>. The file <span
 style="font-style: italic;">udpc_console_u.c</span> needs some
configuration
macros that are located in a header file called <span
 style="font-style: italic;">config.h</span>. The latter is built
automatically by <span style="font-style: italic;">cmake</span> as it
is setup thanks to some <span style="font-style: italic;">cmake</span>
variables.<br>
<br>
The following sub-tree shows the files that have been added to build
the project.<br>
<br>
<table
 style="background-color: rgb(51, 255, 51); text-align: left; margin-left: auto; margin-right: auto; font-family: monospace;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td><span style="font-family: monospace;">&nbsp;</span><span
 style="font-weight: bold; font-family: monospace;">&nbsp; &nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;
project8<br>
      </span><span style="font-family: monospace;">&nbsp;
&nbsp;&nbsp;&nbsp; /
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/
&nbsp;&nbsp;
&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;
&nbsp;
\
&nbsp;&nbsp;
&nbsp;&nbsp;
&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
\</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp;
&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;
\
&nbsp;
&nbsp;
&nbsp;
&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; &nbsp; /
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; /&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp; &nbsp;
&nbsp; &nbsp;&nbsp; \&nbsp; &nbsp;
&nbsp; &nbsp;&nbsp; \&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; /
&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /
&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; \&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; \&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp; \&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
\</span><br style="font-family: monospace;">
      <span style="font-family: monospace;"><a
 href="cmake_projects/project8/udp_console_u.c">udpc_console_u.c</a>&nbsp;&nbsp;











      <a href="cmake_projects/project8/udp_console_k.c">udpc_console_k.c</a>&nbsp;











      </span><a style="font-family: monospace;"
 href="#config.h.cmake_in_project8">config.h.cmake</a><span
 style="font-family: monospace;">&nbsp;&nbsp; udpc&nbsp;&nbsp; &nbsp; <a
 href="#Kbuild_in_project8">Kbuild</a>&nbsp;&nbsp;&nbsp; udpc.ko&nbsp; </span><a
 style="font-family: monospace;" href="#CMakeLists.txt_in_project8">CMakeLists.txt</a><br
 style="font-family: monospace;">
      </td>
    </tr>
  </tbody>
</table>
<br>
Once
the <span style="font-style: italic;">cmake</span> files are setup,
launch <span style="font-style: italic;">cmake</span>
to generate the build
environment:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ cd project8</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">$ cmake .</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">-- Building UDPC version
1.0.0<br>
-- Configuring done<br>
-- Generating done<br>
-- Build files have been written to: .../project8<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br style="font-family: monospace;">
Then, the makefiles are ready to trigger a build with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">Scanning dependencies of
target kudpc<br>
[&nbsp; 0%] Building udpc.ko<br>
[ 50%] Built target kudpc<br>
Scanning dependencies of target udpc<br>
[100%] Building C object CMakeFiles/udpc.dir/udp_console_u.o<br>
Linking C executable udpc <br>
[100%] Built target udpc<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
After it is possible to clean-up anything generated by the <span
 style="font-style: italic;">cmake</span>
environment with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make clean</span></td>
    </tr>
  </tbody>
</table>
<br>
<h3><a name="CMakeLists.txt_in_project8"></a>CMakeLists.txt
in project8</h3>
The directory <span style="font-style: italic;">project8</span>
is the top directory of the project. This is the place where we launch
the <span style="font-style: italic;">cmake</span>
command.<br>
<br>
This is the top <span style="font-style: italic;">CMakeLists.txt</span>
of the project.<br>
We define the minimum version of <span style="font-style: italic;">cmake</span>
that we support for this project through the directive <span
 style="font-weight: bold;">CMAKE_MINIMUM_REQUIRED</span>.<br>
We identify the project as well as the programming language with the <span
 style="font-weight: bold;">PROJECT</span> directive.<br>
Thanks to the <span style="font-weight: bold;">SET</span> directive,
we define a set of variables (<span style="font-style: italic;">PROJECT_NAME,
UDPC_VERSION</span>) that will be used to generate the file <a
 href="#config.h_in_project8"><span style="font-style: italic;">config.h</span></a>.<br>
We make the header file <a href="#config.h_in_project8"><span
 style="font-style: italic;">config.h</span></a> via the directive <span
 style="font-weight: bold;">CONFIGURE_FILE</span>. It is passed a file
skeleton (<a href="#config.h.cmake_in_project8"><span
 style="font-style: italic;">config.h.cmake</span></a>) which will be
converted into <a href="#config.h_in_project8"><span
 style="font-style: italic;">config.h</span></a> with some
substitutions.<br>
We define the flags that will be passed as arguments to the compiler
through the <span style="font-weight: bold;">ADD_DEFINITIONS</span>
directive. It is optional to do it but the default flags passed to the
compiler are not sufficiently severe to check and report the warnings
and bugs.<br>
We specify the target executable <span style="font-style: italic;">udpc</span>
with
the <span style="font-weight: bold;">ADD_EXECUTABLE</span>
directive.<br>
To build the Linux kernel module:<br>
<ul>
  <li>We get the version of the running Linux system by running the
command "<span style="font-style: italic;">uname -r</span>" through the
directive <span style="font-weight: bold;">EXECUTE_PROCESS</span>. We
use the flag OUTPUT_STRIP_TRAILING_WHITESPACE to get rid of the end of
line at the end of the command result.</li>
  <li>The version of the running Linux system is used to make the Linux
kbuild directory that we store in the variable <span
 style="font-weight: bold;">module_build_path</span></li>
  <li>We define the target of the Linux kernel module (<span
 style="font-weight: bold;">ADD_CUSTOM_TARGET</span> directive) and the
way to build it through the directive <span style="font-weight: bold;">ADD_CUSTOM_COMMAND</span>.
This
directive
also
lists
the
dependencies
(<span style="font-weight: bold;">DEPENDS</span>)
of
the
target
to trigger the build only if the source <span
 style="font-style: italic;">udp_console_k.c</span> or <span
 style="font-style: italic;">Kbuild</span> has been
modified. The <span style="font-weight: bold;">COMMENT</span>
tag is useful to make <span style="font-style: italic;">cmake</span>
display the string "Building udpc.ko"
while triggering the command. The file <a href="#Kbuild_in_project8"><span
 style="font-style: italic;">Kbuild</span></a> is used by this command
to build the module as explained in Linux documentation embedded in the
sources of the kernel (<span style="font-style: italic;">.../Documentation/kbuild/kbuild.txt</span>)<br>
  </li>
</ul>
Then the kernel module and the executable are installed through the <span
 style="font-weight: bold;">INSTALL</span> directive.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">cmake_minimum_required(VERSION 2.4)<br>
      <br>
PROJECT(udpc C)<br>
      <br>
SET(PROJECT_NAME UDPC)<br>
      <br>
# Version number<br>
SET(UDPC_MAJOR 1)<br>
SET(UDPC_MINOR 0)<br>
SET(UDPC_PATCH 0)<br>
SET(UDPC_VERSION ${UDPC_MAJOR}.${UDPC_MINOR}.${UDPC_PATCH})<br>
      <br>
      <br>
MESSAGE(STATUS "Building UDPC version ${UDPC_VERSION}")<br>
      <br>
CONFIGURE_FILE(config.h.cmake config.h)<br>
      <br>
      <br>
SET(udpc_src udp_console_u.c)<br>
SET(udpc_exe udpc)<br>
      <br>
ADD_DEFINITIONS(-g -O2 -fsigned-char -freg-struct-return -Wall -W
-Wshadow -Wstrict-prototypes -Wpointer-arith -Wcast-qual -Winline
-Werror)<br>
      <br>
# Build of the program<br>
ADD_EXECUTABLE(${udpc_exe} ${udpc_src})<br>
      <br>
# Build the module<br>
EXECUTE_PROCESS(COMMAND uname -r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
OUTPUT_VARIABLE
os_release<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
OUTPUT_STRIP_TRAILING_WHITESPACE)<br>
SET(module_path /lib/modules/${os_release})<br>
SET(module_build_path ${module_path}/build)<br>
      <br>
ADD_CUSTOM_COMMAND(OUTPUT udpc.ko<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
COMMAND
make
-C
${module_build_path}
M=`pwd`<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DEPENDS
udp_console_k.c
Kbuild<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
COMMENT
"Building
udpc.ko"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
)<br>
      <br>
ADD_CUSTOM_TARGET(kudpc ALL DEPENDS udpc.ko)<br>
      <br>
      <br>
# Installation of the module<br>
SET(module_install_path ${module_path}/kernel)<br>
INSTALL(FILES udpc.ko<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DESTINATION
${module_install_path}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PERMISSIONS OWNER_READ
OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE)<br>
      <br>
# Installation of the program<br>
INSTALL(TARGETS udpc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DESTINATION "bin"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PERMISSIONS OWNER_READ
OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE)<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><br>
<h3><a name="config.h.cmake_in_project8"></a>config.h.cmake in project8</h3>
This file is the skeleton of <a href="#config.h_in_project8"><span
 style="font-style: italic;">config.h</span></a>: all the strings
embraced by the character @ (e.g. @PROJECT_NAME@) are substituted
by the <span style="font-style: italic;">cmake</span> variables with
the same name (e.g. ${PROJECT_NAME}).<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;"></span><span
 style="font-family: monospace;">//
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br>
// File&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : config.h<br>
// Description : Configuration of <span style="color: rgb(255, 0, 0);">@PROJECT_NAME@</span><br>
// License&nbsp;&nbsp;&nbsp;&nbsp; :<br>
//<br>
//&nbsp; Copyright (C) 2011 Rachid Koucha &lt;rachid dot koucha at free
dot fr&gt;<br>
//<br>
//<br>
//&nbsp; This program is free software: you can redistribute it and/or
modify<br>
//&nbsp; it under the terms of the GNU General Public License as
published by<br>
//&nbsp; the Free Software Foundation, either version 3 of the License,
or<br>
//&nbsp; (at your option) any later version.<br>
//<br>
//&nbsp; This program is distributed in the hope that it will be useful,<br>
//&nbsp; but WITHOUT ANY WARRANTY; without even the implied warranty of<br>
//&nbsp; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp; See
the<br>
//&nbsp; GNU General Public License for more details.<br>
//<br>
//&nbsp; You should have received a copy of the GNU General Public
License<br>
//&nbsp; along with this program.&nbsp; If not, see
&lt;http://www.gnu.org/licenses/&gt;.<br>
//<br>
//<br>
// Evolutions&nbsp; :<br>
//<br>
//&nbsp;&nbsp;&nbsp;&nbsp; 25-Jan-2011&nbsp; R.
Koucha&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -
Creation<br>
//<br>
//
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br>
      <br>
#ifndef CONFIG_H<br>
#define CONFIG_H<br>
      <br>
//---------------------------------------------------------------------------<br>
// Name : <span style="color: rgb(255, 0, 0);">@PROJECT_NAME@</span>_VERSION<br>
// Usage: Version of <span style="color: rgb(255, 0, 0);">@PROJECT_NAME@</span><br>
//----------------------------------------------------------------------------<br>
#define <span style="color: rgb(255, 0, 0);">@PROJECT_NAME@</span>_VERSION
"<span style="color: rgb(255, 0, 0);">@UDPC_VERSION@</span>"<br>
      <br>
#endif // CONFIG_H<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><br>
<h3><a name="config.h_in_project8"></a>config.h in project8</h3>
The file <span style="font-style: italic;">config.h</span> is the
result of the
substitutions done by the directive <span style="font-weight: bold;">CONFIGURE_FILE</span>
into the file <a style="font-style: italic;"
 href="#config.h.cmake_in_project8">config.h.cmake</a>.<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">//
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br>
// File&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : config.h<br>
// Description : Configuration of <span style="color: rgb(255, 0, 0);">UDPC</span><br>
// License&nbsp;&nbsp;&nbsp;&nbsp; :<br>
//<br>
//&nbsp; Copyright (C) 2011 Rachid Koucha &lt;rachid dot koucha at free
dot fr&gt;<br>
//<br>
//<br>
//&nbsp; This program is free software: you can redistribute it and/or
modify<br>
//&nbsp; it under the terms of the GNU General Public License as
published by<br>
//&nbsp; the Free Software Foundation, either version 3 of the License,
or<br>
//&nbsp; (at your option) any later version.<br>
//<br>
//&nbsp; This program is distributed in the hope that it will be useful,<br>
//&nbsp; but WITHOUT ANY WARRANTY; without even the implied warranty of<br>
//&nbsp; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp; See
the<br>
//&nbsp; GNU General Public License for more details.<br>
//<br>
//&nbsp; You should have received a copy of the GNU General Public
License<br>
//&nbsp; along with this program.&nbsp; If not, see
&lt;http://www.gnu.org/licenses/&gt;.<br>
//<br>
//<br>
// Evolutions&nbsp; :<br>
//<br>
//&nbsp;&nbsp;&nbsp;&nbsp; 25-Jan-2011&nbsp; R.
Koucha&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -
Creation<br>
//<br>
//
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br>
      <br>
#ifndef CONFIG_H<br>
#define CONFIG_H<br>
      <br>
//---------------------------------------------------------------------------<br>
// Name : <span style="color: rgb(255, 0, 0);">UDPC</span>_VERSION<br>
// Usage: Version of <span style="color: rgb(255, 0, 0);">UDPC</span><br>
//----------------------------------------------------------------------------<br>
#define <span style="color: rgb(255, 0, 0);">UDPC</span>_VERSION "<span
 style="color: rgb(255, 0, 0);">1.0.0</span>"<br>
      <br>
#endif // CONFIG_H<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
<h3><a name="Kbuild_in_project8"></a>Kbuild in project8</h3>
The file<a href="cmake_manual.html#Kbuild_in_project8"><span
 style="font-style: italic;"></span></a> <span
 style="font-style: italic;">Kbuild</span> as explained in Linux
documentation embedded in the sources of the kernel (<span
 style="font-style: italic;">.../Documentation/kbuild/kbuild.txt</span>)
to
build
a
kernel
module:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;"># Driver for the UDP based Linux
console<br>
obj-m += udpc.o<br>
udpc-objs := udp_console_k.o<br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
<hr style="width: 100%; height: 2px;">
<h2><span style="text-decoration: underline;"><a
 name="Project_9:_Generation_of_a_graphical"></a>Project 9</span>:
Generation of a graphical executable based on Qt library<br>
</h2>
The project called <span style="font-weight: bold;">PROJECT9</span>
is composed with the following sub-tree (the files are located <a
 href="http://rachid.koucha.free.fr/tech_corner/cmake_projects/project9">here</a>):<br>
<br>
<table style="text-align: left; background-color: rgb(51, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="text-align: center; vertical-align: middle;">
      <div style="text-align: center;">
      <div style="text-align: center;"><span
 style="font-family: monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;
project9</span></span><br>
      </div>
      <span style="font-family: monospace;"><span
 style="font-weight: bold;"></span></span></div>
      <span style="font-family: monospace;"><span
 style="font-weight: bold;"> </span>&nbsp; /&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp; &nbsp; \<br>
&nbsp; / &nbsp;&nbsp;&nbsp;&nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; &nbsp; \<br>
&nbsp; /&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | &nbsp; &nbsp;&nbsp; &nbsp; \<span
 style="font-weight: bold;"><br>
      </span>&nbsp; / &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
&nbsp; &nbsp;&nbsp; &nbsp; \<br>
      <a href="cmake_projects/project9/hello.cc">hello.cc</a> &nbsp; <a
 href="#CMakeLists.txt_in_project9">CMakeLists.txt</a>&nbsp; hello<br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
The
project generates one target: an executable called <span
 style="font-weight: bold;">hello</span><span style="font-weight: bold;"></span>.
All
the
objects are stored into the top level directory<span
 style="font-style: italic;"></span>.<br>
<br>
<span style="font-style: italic;"></span><span
 style="font-style: italic;"></span><span style="font-style: italic;"></span><span
 style="font-style: italic;"></span>Once
the <span style="font-style: italic;">cmake</span> files are setup,
launch <span style="font-style: italic;">cmake</span>
to generate the build
environment:<br>
<br>
<span style="font-family: monospace;"></span><br>
<table style="background-color: rgb(255, 204, 102);" border="1"
 cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
    </tr>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ cd project9<br>
$ cmake .<br>
-- The CXX compiler identification is GNU<br>
-- Check for working CXX compiler: /usr/bin/c++<br>
-- Check for working CXX compiler: /usr/bin/c++ -- works<br>
-- Detecting CXX compiler ABI info<br>
-- Detecting CXX compiler ABI info - done<br>
Found Qt include files in /usr/include/qt4<br>
Found Qt libraries in /usr/lib<br>
-- Configuring done<br>
-- Generating done<br>
-- Build files have been written to: .../project9<br>
      </span></td>
    </tr>
  </tbody>
</table>
<br>
Then, the makefiles are ready to trigger a build with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">Scanning dependencies of
target hello<br>
[100%] Building CXX object
CMakeFiles/hello.dir/hello.o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

      <br>
Linking CXX executable
hello&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

      <br>
[100%] Built target hello<br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
The executable is a simple "Hello world" program that uses <a
 href="http://qt.nokia.com/">Qt</a> graphical API. The call to the
executable triggers the following:<br>
<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ ./hello &amp;</span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;"><br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

      <img style="width: 120px; height: 54px;" alt="hello.png"
 src="cmake_projects/project9/hello.png"><br>
      <br>
      </span><span style="font-family: monospace;"></span></td>
    </tr>
  </tbody>
</table>
<br>
After it is possible to clean-up anything generated by the <span
 style="font-style: italic;">cmake</span>
environment with:<br>
<br>
<table style="text-align: left; background-color: rgb(255, 204, 0);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;"><span
 style="font-family: monospace;">$ make clean</span></td>
    </tr>
  </tbody>
</table>
<br>
<h3><a name="CMakeLists.txt_in_project9"></a>CMakeLists.txt
in project9</h3>
The directory <span style="font-style: italic;">project9</span>
is the top directory of the project. This is the place where we launch
the <span style="font-style: italic;">cmake</span>
command.<br>
<br>
This is the top <span style="font-style: italic;">CMakeLists.txt</span>
of the project.<br>
We define the minimum version of <span style="font-style: italic;">cmake</span>
that we support for this project through the directive <span
 style="font-weight: bold;">CMAKE_MINIMUM_REQUIRED</span>.<br>
We identify the project as well as the programming language with the <span
 style="font-weight: bold;">PROJECT</span> directive. <span
 style="font-weight: bold;">CXX</span> stands for C++ language.<br>
As the program needs Qt include files, we look for the location of
those files thanks to the <span style="font-weight: bold;">FIND_PATH</span>
directive. The trick consists to look for a well known sub-directory
name (i.e. QtGui) belonging to the Qt environment. <span
 style="font-weight: bold;">FIND_PATH</span> stores the result of the
search into the QT_INC_DIR variable. The content of this variable is
checked and we extract the root directory of the include files thanks
to the <span style="font-weight: bold;">STRING</span> directive.<br>
We define the flags that will be passed as arguments to the compiler
through the <span style="font-weight: bold;">ADD_DEFINITIONS</span>
directive. It is optional to do it but the default flags passed to the
compiler are not sufficiently severe to check and report the warnings
and bugs.<br>
We specify the include directory thanks to the <span
 style="font-weight: bold;">INCLUDE_DIRECTORIES</span> directive.<br>
We specify the target executable <span style="font-style: italic;">hello</span>
with
the <span style="font-weight: bold;">ADD_EXECUTABLE</span>
directive and the libraries to link with it thanks the <span
 style="font-weight: bold;">TARGET_LINK_LIBRARIES</span> directive.<br>
<br>
<table
 style="text-align: left; background-color: rgb(255, 204, 0); font-family: monospace;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(255, 204, 0); white-space: nowrap;">CMAKE_MINIMUM_REQUIRED(VERSION
2.8)<br>
      <br>
PROJECT(hello
CXX)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

      <br>
      <br>
FIND_PATH(QT_INC_DIR<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NAMES QtGui<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PATHS
/usr/include<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/usr/include/qt4)<br>
      <br>
IF(NOT QT_INC_DIR)<br>
      <br>
&nbsp;&nbsp; MESSAGE(FATAL_ERROR "Unable to find Qt include files")<br>
      <br>
ELSE(NOT QT_INC_DIR)<br>
      <br>
&nbsp;&nbsp; STRING(REGEX REPLACE "/QtGui" "" QT_INC_DIR
"${QT_INC_DIR}")<br>
&nbsp;&nbsp; MESSAGE("Found Qt include files in " ${QT_INC_DIR})<br>
      <br>
ENDIF(NOT QT_INC_DIR)<br>
      <br>
      <br>
ADD_DEFINITIONS(-g -O2 -fsigned-char -freg-struct-return -Wall -W
-Wshadow -Wpointer-arith -Wcast-qual -Winline -Werror)<br>
      <br>
INCLUDE_DIRECTORIES(${QT_INC_DIR})<br>
      <br>
ADD_EXECUTABLE(hello hello.cc)<br>
      <br>
TARGET_LINK_LIBRARIES(hello QtCore QtGui)<br>
      </td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><br>
<hr style="width: 100%; height: 2px;">
<h2><a name="Open_source_projects_using_cmake"></a>Open source projects
using
cmake</h2>
Here are links on free software using cmake:<br>
<ul>
  <li><a href="http://roof.sourceforge.net/">roof</a></li>
  <li><a href="http://cmdline.sourceforge.net/">cmdline</a></li>
  <li><a href="http://pdip.sourceforge.net/">pdip</a></li>
  <li><a href="http://udpc.sourceforge.net/">udpc</a><br>
  </li>
</ul>
<h2><a name="Resources"></a>Resources</h2>
<ul>
  <li><a href="http://www.cmake.org">cmake home page</a> </li>
  <li><a
 href="http://rachid.koucha.free.fr/tech_corner/cmake_manual_fr.html">This
article
in
french</a><br>
  </li>
  <li>On-line manual of cmake - man 1 cmake</li>
  <li>On-line manual of cpack - man 1 cpack</li>
  <li>GNU Linux Magazine number 108: CMake et vos biblioth&egrave;ques <a
 href="http://www.gnulinuxmag.com/index.php?2007/02/26/48-gnu-linux-magazine-92-mars-2007-en-kiosque"><img
 style="border: 0px solid ; width: 100px; height: 31px;" alt="GLMF logo"
 src="glmf_logo.gif"></a></li>
  <li>GNU Linux Magazine number 105: Quelques exemples d&#8217;utilisation de
CMake <a
 href="http://www.gnulinuxmag.com/index.php?2007/02/26/48-gnu-linux-magazine-92-mars-2007-en-kiosque"><img
 style="border: 0px solid ; width: 100px; height: 31px;" alt="GLMF logo"
 src="glmf_logo.gif"></a></li>
  <li>GNU Linux Magazine number 92: CMake : la rel&egrave;ve dans la
construction de projet <a
 href="http://www.gnulinuxmag.com/index.php?2007/02/26/48-gnu-linux-magazine-92-mars-2007-en-kiosque"><img
 style="border: 0px solid ; width: 100px; height: 31px;" alt="GLMF logo"
 src="glmf_logo.gif"></a></li>
  <li>Builds et tests, Utilisation de CMake et de Dart - <a
 href="http://www.irisa.fr/lagadic/pdf/2006_cmake_code&amp;travaux_spindler.pdf">http://www.irisa.fr/lagadic/pdf/2006_cmake_code&amp;travaux_spindler.pdf</a></li>
  <li><a href="http://kernigh.pbwiki.com/CMake">kernigh's
personal wiki</a></li>
</ul>
<h2><a name="About_the_author"></a>About the
author</h2>
The author is an engineer in computer sciences located in France. He
can be contacted <a
 href="http://rachid.koucha.free.fr/contact/contact.html">here</a> or
you can have
a look at his <a href="http://rachid.koucha.free.fr/">WEB
home page</a>.<br>
<br>
<table
 style="text-align: left; margin-left: auto; margin-right: auto; background-color: rgb(153, 255, 255);">
  <tbody>
    <tr>
      <td>
      <script type="text/javascript"><!--
google_ad_client = "pub-9113501896220746";
/* 728x90, date de création 29/03/08 */
google_ad_slot = "7632855209";
google_ad_width = 728;
google_ad_height = 90;
//--></script>
      <script type="text/javascript"
 src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script><br>
      </td>
    </tr>
  </tbody>
</table>
<div style="text-align: right;"><small><a
 href="http://rachid.koucha.free.fr/index.html">Back to main page</a></small><br>
<small><a href="http://rachid.koucha.free.fr/technical_documents.html">Back
to
previous
page</a><br>
<br>
</small></div>
</body>
</html>
