<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=ISO-8859-1">
  <title>Linked lists in the Linux kernel</title>
  <meta name="author" content="rachid koucha">
  <meta name="Category" content="linked list, Linux, kernel">
  <meta name="language" content="en">
  <meta http-equiv="Content-Language" content="en">
  <meta name="description"
 content="how to use linked lists in linux kernel">
  <meta name="keywords" content="Linux, ubuntu, linked list, kernel">
  <script type="text/javascript"
 src="https://apis.google.com/js/plusone.js"></script>
</head>
<body style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<small><small><u>Author</u>: R. Koucha<br>
<u>Last update</u>: 31-Mar-2008<br>
</small></small><br>
<br>
<small><a href="../index.html">Back to main page</a><br>
<a href="../technical_documents.html">Back to previous page</a></small><br>
<h1 align="center">Using linked list in the Linux kernel</h1>
<br>
<table style="text-align: left; margin-left: auto; margin-right: auto;">
  <tbody>
    <tr>
      <td>
      <script type="text/javascript"><!--
google_ad_client = "pub-9113501896220746";
/* 728x90, date de création 29/03/08 */
google_ad_slot = "7632855209";
google_ad_width = 728;
google_ad_height = 90;
//--></script>
      <script type="text/javascript"
 src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="text-align: left; width: 100%;" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; height: 50%; width: 50%;"><br>
      </td>
      <td style="vertical-align: top;"><iframe
 src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Frachid.koucha.free.fr%2Ftech_corner%2Flinked_lists_in_kernel.html&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light&amp;height=80"
 style="border: medium none ; overflow: hidden; width: 450px; height: 80px;"
 allowtransparency="true" frameborder="0" scrolling="no"></iframe> <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><g:plusone size="medium"></g:plusone>
      <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><a
 href="mailto:?body=http%3A%2F%2Frachid.koucha.free.fr%2Ftech_corner%2Flinked_lists_in_kernel.html&amp;subject=Using%20linked%20lists%20in%20the%20Linux%20kernel"><img
 alt="s" src="../send_to_a_friend.gif"
 style="border: 0px solid ; width: 30px; height: 21px;"></a></td>
    </tr>
  </tbody>
</table>
<br>
<a href="#About_the_author">About the author<br>
</a><br>
<br>
<br>
<br>
The service is defined in &lt;linux/list.h&gt;<br>
<br>
A list link is defined as:<br>
<br>
<tt>struct list_head <br>
{<br>
&nbsp;&nbsp;&nbsp; struct list_head *next, *prev;<br>
};<br>
<br>
<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+----------+<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;&nbsp; | &nbsp;
next &nbsp; |<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;&nbsp; | &nbsp;
prev &nbsp; |<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;&nbsp;
+----------+<br>
</b></tt><br>
To define and initialize a head of list:<br>
<br>
<tt>LIST_HEAD(hdr);<br>
</tt><br>
This defines "hdr" as an empty list:<br>
<tt><br>
struct list_head hdr =&nbsp; { &amp;hdr, &amp;hdr };<br>
<br>
<br>
</tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+--------------------+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>hdr</b>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+---&gt;<b>+----------+</b>&nbsp;&nbsp;&nbsp;
|<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
&nbsp;&nbsp; <b>|</b>
&nbsp; <b>next</b> &nbsp; <b>|</b>----+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp; <b>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
&nbsp;&nbsp; <b>|</b>
&nbsp; <b>prev</b> &nbsp; <b>|</b></tt><tt>----+</tt><br>
<tt>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; |&nbsp; &nbsp; <b>+----------+</b>
&nbsp;&nbsp; |<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br>
</tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+--------------------+<br>
</tt><tt>&nbsp;&nbsp;&nbsp; <br>
</tt>To initialize an element that is destined to be inserted in
a list.<br>
<br>
<tt>struct list_head elt;<br>
...<br>
INIT_LIST_HEAD(&amp;elt);</tt><br>
<br>
<tt><br>
</tt>So, an empty list is a list for which the header points on
itself:
p-&gt;next = p-&gt;prev = p. The service "<font color="#ff0000">list_empty()</font>"
returns
0
if
a
list
is
not
empty
and non 0 otherwise:<br>
<br>
<tt><br>
LIST_HEAD(hdr);</tt><br>
<tt>...<br>
if (list_empty(&amp;hdr))<br>
{<br>
&nbsp; /* The list is empty */<br>
}<br>
else<br>
{<br>
&nbsp; /* The list is not empty */<br>
}</tt><br>
<br>
<font color="#ff0000">list_add()</font> inserts an
element at the
beginning of the list (i.e. just after the specified head):<br>
<br>
<tt>LIST_HEAD(hdr);<br>
struct list_head elt;</tt><br>
<tt>...<br>
list_add(&amp;elt, &amp;hdr);<br>
<br>
</tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+----------------------------------------------+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>hdr</b>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>elt</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+---&gt;<b>+----------+</b>&nbsp;&nbsp;&nbsp;
+-----+---&gt;<b>+----------+</b>&nbsp;&nbsp;
|<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
&nbsp;&nbsp; <b>|</b>
&nbsp; <b>next</b> &nbsp; <b>|</b>----+&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp; <b>|&nbsp;&nbsp;
next&nbsp;&nbsp; |</b>---+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp; <b>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp; <b>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
&nbsp;&nbsp; <b>|</b>
&nbsp; <b>prev</b> &nbsp; <b>|</b></tt><tt>----------+&nbsp;&nbsp;&nbsp;
<b>|&nbsp;&nbsp; prev&nbsp;&nbsp; |</b>---+</tt><br>
<tt>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
|&nbsp; &nbsp; <b>+----------+</b>
&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>+----------+</b>&nbsp;&nbsp;
|<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|<br>
</tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+----------------------------------------------+<br>
</tt><br>
<font color="#ff0000">list_add_tail()</font> inserts
an element at the
end of the list (i.e. just before the specified head):<br>
<br>
<tt>LIST_HEAD(hdr);<br>
struct list_head elt;</tt><br>
<tt>...<br>
list_add_tail(&amp;elt, &amp;hdr);<br>
<br>
</tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+----------------------------------------------+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>elt</b>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>hdr</b>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+---&gt;<b>+----------+</b>&nbsp;&nbsp;&nbsp;
+-----+---&gt;<b>+----------+</b>&nbsp;&nbsp;
|<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
&nbsp;&nbsp; <b>|</b>
&nbsp; <b>next</b> &nbsp; <b>|</b>----+&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp; <b>|&nbsp;&nbsp;
next&nbsp;&nbsp; |</b>---+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp; <b>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp; <b>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
&nbsp;&nbsp; <b>|</b>
&nbsp; <b>prev</b> &nbsp; <b>|</b></tt><tt>----------+&nbsp;&nbsp;&nbsp;
<b>|&nbsp;&nbsp; prev&nbsp;&nbsp; |</b>---+</tt><br>
<tt>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
|&nbsp; &nbsp; <b>+----------+</b>
&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>+----------+</b>&nbsp;&nbsp;
|<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|<br>
</tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+----------------------------------------------+<br>
<br>
</tt><font color="#ff0000">list_del_init()</font>
removes an element
from the list it is linked to and reinitialize the element:<br>
<br>
<tt>LIST_HEAD(hdr);<br>
</tt><tt>struct list_head elt;<br>
</tt><tt>struct list_head *p;</tt><br>
<tt>...<br>
<br>
/* Add elt into the list 'hdr' */<br>
list_add_tail(&amp;elt, &amp;hdr);</tt><br>
<tt>...<br>
p = elt;<br>
...<br>
/* Suppress 'elt' from the list */<br>
list_del_init(p);<br>
<br>
<br>
</tt><font color="#ff0000">list_move()</font>
moves an element from its
current list to the beginning of another list:<br>
<br>
<tt>LIST_HEAD(hdr);<br>
</tt><tt>LIST_HEAD(hdr1);<br>
</tt><tt>
struct list_head elt;<br>
</tt><tt>
struct list_head *p;</tt><br>
<tt>...<br>
<br>
/* Add elt into the list 'hdr' */<br>
list_add_tail(&amp;elt, &amp;hdr);</tt><br>
<tt>
...<br>
p = &amp;elt;<br>
...<br>
/* Move 'elt' from the list 'hdr' to 'hdr1' */<br>
list_move(p, &amp;hdr1);<br>
<br>
</tt><br>
<font color="#ff0000">list_move_tail()</font> has
the same interface as
<font color="#ff0000">list_move()</font> but moves
an element from its
current list to the end of another list.<br>
<br>
<font color="#ff0000">list_splice()</font> appends a
list to another. <font color="#ff0000">list_splice_init()</font>
does the same operation but
reinitializes the head of the emptied list.<br>
<tt><br>
LIST_HEAD(hdr);<br>
</tt><tt>LIST_HEAD(hdr1);<br>
...<br>
/* Append list 'hdr1' to 'hdr' */<br>
list_splice(&amp;hdr1, &amp;hdr);<br>
<br>
<br>
</tt>When the 'list_head' structures are embedded into high level
structures, it is possible to retrieve the high level structure from a
pointer on a 'list_head' through <font color="#ff0000">list_entry()</font>:<br>
<br>
<tt>typedef struct<br>
{<br>
int f;<br>
struct list_head link;<br>
} high_level_t;<br>
<br>
</tt><tt>LIST_HEAD(hdr);<br>
high_level_t elt;<br>
struct list_head *p;<br>
high_level_t *phl;<br>
...<br>
/* Insert the high level structure into the list */<br>
list_add(&amp;(elt.link), &amp;hdr);<br>
...<br>
/* Retrieve the high level information from the list links */<br>
p = &amp;(elt.link);<br>
phl = list_entry(p, </tt><tt>high_level_t, link</tt><tt>);<br>
</tt><br>
<font color="#ff0000">list_for_each()</font>
iterates over a list from
the beginning to the end of the list:<br>
<br>
<tt>typedef struct<br>
{<br>
int f;<br>
struct list_head link;<br>
} high_level_t;<br>
<br>
</tt><tt>LIST_HEAD(hdr);<br>
<br>
struct list_head *p;<br>
</tt><tt>high_level_t *phl;</tt><br>
<tt>...<br>
list_for_each(p, &amp;hdr)<br>
{<br>
&nbsp; p</tt><tt>hl = list_entry(p, </tt><tt>high_level_t,
link</tt><tt>);<br>
&nbsp; printf("f = %d\n", phl-&gt;f);<br>
</tt><tt>} /* End for list */<br>
<br>
</tt><font color="#ff0000">list_for_each_entry()</font>
is an extension
of <font color="#ff0000">list_for_each()</font> as
it iterates over a
list using a pointer on a high level structure:<br>
<tt><br>
typedef struct<br>
{<br>
int f;<br>
struct list_head link;<br>
} high_level_t;<br>
<br>
</tt><tt>LIST_HEAD(hdr);<br>
<br>
</tt><tt>high_level_t *phl;</tt><br>
<tt>...<br>
list_for_each_entry(phl, &amp;hdr, link)<br>
{</tt><tt><br>
&nbsp; printf("f = %d\n", phl-&gt;f);<br>
</tt><tt>} /* End for list */<br>
</tt><br>
<font color="#ff0000">list_for_each_entry_reverse()</font>
does the
same as <font color="#ff0000">list_for_each_entry()</font>
but
iterates over the list from the end to the beginning.<br>
<br>
<font color="#ff0000">list_for_each_entry_continue()</font>
used along
with <font color="#ff0000">list_prepare_entry()</font>
iterates over a
list from a given element to the end of the list:<br>
<br>
<tt>typedef struct<br>
{<br>
int f;<br>
struct list_head link;<br>
} high_level_t;<br>
<br>
</tt><tt>LIST_HEAD(hdr);<br>
<br>
</tt><tt>high_level_t *phl, *p;</tt><br>
<tt>...<br>
phl = NULL;<br>
<br>
/* Point on some element in the list */<br>
p = &amp;elt;<br>
<br>
/* Loop from element 'p' to the end of the list (if 'p' is NULL, 'phl'
will point on the beginning of the list) */<br>
phl = list_prepare_entry(p, &amp;hdr, link);<br>
list_for_each_entry_continue(phl, &amp;hdr, link)<br>
{</tt><tt><br>
&nbsp; printf("f = %d\n", phl-&gt;f);<br>
</tt><tt>} /* End for list */<br>
</tt><br>
<tt><br>
</tt>
<h2><a name="About_the_author"></a>About the
author</h2>
The author is an engineer in computer sciences located in France. He
can be contacted <a
 href="http://rachid.koucha.free.fr/contact/contact.html">here</a> or
you can have
a look at his <a href="http://rachid.koucha.free.fr/">WEB
home page</a>.<br>
<br>
<small><br>
</small>
<div style="text-align: right;"><small><a href="../index.html">Back to
main page</a></small><br>
<small><a href="../technical_documents.html">Back to previous page</a></small><br>
</div>
<br>
<pre class="moz-signature" cols="72"><br></pre>
</body>
</html>
