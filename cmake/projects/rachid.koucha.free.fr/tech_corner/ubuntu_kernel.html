<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
  <title>how to make a linux ubuntu kernel</title>
  <meta name="author" content="rachid koucha">
  <meta name="Category" content="linux, freeware, ubuntu, kernel">
  <meta name="language" content="en">
  <meta http-equiv="Content-Language" content="en">
  <meta name="description"
 content="how to make a linux kernel under ubuntu">
  <meta name="keywords"
 content="linux, ubuntu, kernel, kernel-package, dpkg, grub, freeware">
  <script type="text/javascript"
 src="https://apis.google.com/js/plusone.js"></script>
</head>
<body>
<small><a href="../technical_documents.html">Go back to previous page</a><br>
<a href="../index.html">Go back to home page</a></small>
<h1 style="text-align: center;">How to make and install a
new kernel</h1>
<h1 style="text-align: center;">&nbsp;under Ubuntu</h1>
<table
 style="background-color: rgb(51, 102, 255); text-align: left; margin-left: auto; margin-right: auto;">
  <tbody>
    <tr>
      <td style="background-color: rgb(51, 102, 255);">
      <script type="text/javascript"><!--
google_ad_client = "pub-9113501896220746";
/* 728x90, date de création 29/03/08 */
google_ad_slot = "7632855209";
google_ad_width = 728;
google_ad_height = 90;
//--></script>
      <script type="text/javascript"
 src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="text-align: left; width: 100%;" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; height: 50%; width: 50%;"><br>
      </td>
      <td style="vertical-align: top;"><iframe
 src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Frachid.koucha.free.fr%2Ftech_corner%2Fubuntu_kernel.html&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light&amp;height=80"
 style="border: medium none ; overflow: hidden; width: 450px; height: 80px;"
 allowtransparency="true" frameborder="0" scrolling="no"></iframe> <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><g:plusone size="medium"></g:plusone>
      <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><a
 href="mailto:?body=http%3A%2F%2Frachid.koucha.free.fr%2Ftech_corner%2Fubuntu_kernel.html&amp;subject=How%20to%20make%20a%20linux%20ubuntu%20kernel"><img
 alt="s" src="../send_to_a_friend.gif"
 style="border: 0px solid ; width: 30px; height: 21px;"></a></td>
    </tr>
  </tbody>
</table>
<br>
<br>
<a href="#Install_the_required_packages_for_Kernel">Install
the required packages for Kernel compilation</a><br>
<a href="#Configure_the_Kernel">Configure the Kernel</a><br>
<a href="#Build_the_Kernel">Build the Kernel</a><br>
<a href="#Install_the_new_Kernel">Install the new Kernel</a><br>
<a href="#Links">Links</a><br>
<a href="#About_the_author">About the author</a><br>
<br>
<h2><a name="Install_the_required_packages_for_Kernel"></a>Install
the required packages for Kernel compilation </h2>
<p>Check that<span style="font-style: italic;">
kernel-package</span> is installed to be able to build the Linux
kernel related Debian packages:</p>
<p><span style="font-family: monospace;">$ dpkg -l |
grep kernel-package</span><br style="font-family: monospace;">
<span style="font-family: monospace;">ii&nbsp;
kernel-package&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11.001&nbsp;&nbsp;&nbsp;
&nbsp;A
utility
for
building
Linux kernel related Debian pac</span></p>
<p>If the previous command does not show the installation, get
the package:</p>
<p style="font-family: monospace;" class="command">$
sudo apt-get install kernel-package</p>
<p class="command">???? Install qt3 to be able to "make
xconfig"</p>
<h2><a name="Configure_the_Kernel"></a>Configure
the Kernel</h2>
<p>Make a backup of the source directory to be able to go back to
a clean version if one of the following actions fail.</p>
<p>Go into the source directory:</p>
<p><span style="font-family: monospace;">$ cd
/usr/src/linux-source-2.6.22</span></p>
<p>If it is needed to configure the new kernel from the current
kernel
configuration, copy the configuration into the source directory<span
 class="system"></span>:</p>
<p class="command"><span style="font-family: monospace;">$
sudo cp /boot/config-`uname -r`&nbsp;.config</span> </p>
<p>Optionally, add the patches and any other modifications into
the source tree.</p>
<p> Then, configure the kernel: </p>
<p style="font-family: monospace;" class="command">$ sudo make oldconfig</p>
<p style="font-family: monospace;" class="command">$ sudo make
menuconfig</p>
<p>Or if <span style="font-style: italic;">libqt3</span>
is installed:</p>
<p><span style="font-family: monospace;">$ sudo make
xconfig</span><br>
</p>
<p>This brings up the kernel configuration menu. Go to "<span
 class="system"><span style="font-style: italic;">Load
an Alternate Configuration File</span>"</span> and choose <span
 class="system">the .config file just modified</span>:</p>
??? screen shot of menu ???
<h2><a name="Build_the_Kernel"></a>Build the
Kernel</h2>
<p>Run a <span style="font-style: italic;">make-kpkg
clean</span> after configuring the kernel using make
(x|menu)?config, since&nbsp; that&nbsp; creates&nbsp;
the&nbsp; file&nbsp;<span style="font-style: italic;">include/linux/version.h</span>&nbsp;without
the
<span style="font-style: italic;">append_to_version</span>
data. This file won&#8217;t be updated by the <span
 style="font-style: italic;">make-kpkg run</span> (<span
 style="font-style: italic;">make-kpkg</span> creates <span
 style="font-style: italic;">version.h</span> if it
doesn&#8217;t exist, but doesn&#8217;t touch if exists), so the final kernel
will&nbsp;not have the <span style="font-style: italic;">append_to_version</span>
data in its version number and it shall look for the modules and
symbols in all the wrong places. So, clean up the subtree:</p>
<p style="font-family: monospace;" class="command">$
sudo make-kpkg clean</p>
<p class="command">Launch the build of the kernel with <span
 style="font-style: italic;">make-kpkg</span> command.<br>
The <span style="font-style: italic;">--initrd</span>
option will build a kernel loading with an initial ramdisk.<br>
The <span class="system"><span style="font-style: italic;">--append-to-version</span>
</span>option specifies an extra version number. Here we choose <span
 style="font-style: italic;">-tipc</span>.<br>
The <span style="font-style: italic;">kernel_image</span>
target produces a Debian package of the Linux kernel source image and
any modules configured in the kernel configuration file <span
 style="font-style: italic;">.config</span>.<br>
The <span style="font-style: italic;">kernel_headers</span>
target produces a Debian package containing the header files included
in the Linux kernel.<br>
<span style="font-family: monospace;"></span></p>
<p class="command"><span style="font-family: monospace;">$
sudo make-kpkg --initrd --append-to-version=-tipc kernel_image
kernel_headers modules_image</span> </p>
<p>After <span class="system"><span style="font-style: italic;">--append-to-version</span>,
</span>you can write
any string that helps you identify the kernel, but it must begin with a
minus (-) and must not contain whitespace.</p>
<p>The compilation ends with two debian packages in <span
 style="font-style: italic;">/usr/src</span>:</p>
<p style="font-family: monospace;">$ ls -l /usr/src<br>
[...]<br>
-rw-r--r--&nbsp; 1 root src&nbsp;&nbsp;&nbsp; 8593764
2008-02-01 17:03
linux-headers-2.6.22.9-tipc_2.6.22.9-tipc-10.00.Custom_i386.deb<br>
-rw-r--r--&nbsp; 1 root src&nbsp; 215398422 2008-02-01 16:57
linux-image-2.6.22.9-tipc_2.6.22.9-tipc-10.00.Custom_i386.deb<br>
[...]</p>
<h2><a name="Install_the_new_Kernel"></a>Install
the new Kernel</h2>
Install the packages:<br>
<p style="font-family: monospace;" class="command">$
cd /usr/src<br>
$ sudo dpkg -i
linux-headers-2.6.22.9-tipc_2.6.22.9-tipc-10.00.Custom_i386.deb<br>
$ sudo dpkg
-i&nbsp;linux-image-2.6.22.9-tipc_2.6.22.9-tipc-10.00.Custom_i386.deb</p>
<p>Verify the installation:</p>
<p><span style="font-family: monospace;">$ dpkg -l |
grep linux-image<br>
[...]<br>
ii&nbsp;
linux-image-2.6.22.9-tipc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
2.6.22.9-tipc-10.00.Custom&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Linux
kernel
binary
image
for version 2.6.22.9-tipc</span><br style="font-family: monospace;">
<span style="font-family: monospace;">[...]</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;"></span><br>
Two stanzas have been added to <span style="font-style: italic;">/boot/grub/menu.lst</span>:</p>
<p><span style="font-family: monospace;">$ cat
/boot/grub/menu.lst</span><br>
<span style="font-family: monospace;">[...]<br>
title&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Ubuntu 7.10, kernel 2.6.22.9-tipc<br>
root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(hd0,0)<br>
kernel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/boot/vmlinuz-2.6.22.9-tipc
root=UUID=40e71a91-f1fc-4e08-a8ac-ddf0497dbc44 ro quiet splash<br>
initrd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/boot/initrd.img-2.6.22.9-tipc<br>
quiet<br>
<br>
title&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Ubuntu 7.10, kernel 2.6.22.9-tipc (recovery mode)<br>
root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(hd0,0)<br>
kernel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/boot/vmlinuz-2.6.22.9-tipc
root=UUID=40e71a91-f1fc-4e08-a8ac-ddf0497dbc44 ro single<br>
initrd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/boot/initrd.img-2.6.22.9-tipc<br>
[...]</span><span style="font-family: monospace;"></span></p>
The system is ready to be rebooted. After restart, it is possible to
check the current installed kernel with:<br>
<p style="font-family: monospace;" class="command">$
uname -r</p>
<p>If the system doesn't start, restart it and select another
kernel by typing ESC upon this messages:</p>
<p style="font-family: monospace;">press <span class="system">ESC</span>
to enter the GRUB menu:</p>
Go to this <a href="ubuntu_kernel_cleanup.html">page</a>
if you want to uninstalled your newly created kernel.<br>
<br>
<h2><a name="Links"></a>Links</h2>
<ul>
  <li><a href="ubuntu_cleanup.html">How to
get rid of useless linux ubuntu kernels</a></li>
</ul>
<h2><a name="About_the_author"></a>About the
author</h2>
The author is an engineer in computer sciences located in France. He
can be contacted <a
 href="http://rachid.koucha.free.fr/contact/contact.html">here</a> or
you can have
a look at his <a href="http://rachid.koucha.free.fr/">WEB
home page</a>.<br>
<br>
<br>
<br>
<div style="text-align: right;">
<table
 style="background-color: rgb(51, 102, 255); text-align: left; margin-left: auto; margin-right: auto;">
  <tbody>
    <tr>
      <td style="background-color: rgb(51, 102, 255);">
      <script type="text/javascript"><!--
google_ad_client = "pub-9113501896220746";
/* 728x90, date de création 29/03/08 */
google_ad_slot = "7632855209";
google_ad_width = 728;
google_ad_height = 90;
//--></script>
      <script type="text/javascript"
 src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script><br>
      </td>
    </tr>
  </tbody>
</table>
<small><a href="../technical_documents.html">Go back to previous page</a></small><br>
<small><a href="../index.html">Go back to home page</a></small></div>
</body>
</html>
